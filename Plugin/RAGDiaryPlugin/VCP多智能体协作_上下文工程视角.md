# VCP å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿï¼šä¸Šä¸‹æ–‡å·¥ç¨‹çš„å®è·µä¹‹é“

> **ä½œè€…**: è·¯è¾¹ä¸€æ¡å°ç™½ & æµ®æµ®é…±
> **æ–‡æ¡£ç‰ˆæœ¬**: 3.0 (äº’åŠ¨æ€è€ƒç‰ˆ)
> **æ›´æ–°æ—¥æœŸ**: 2025-10-03
> **æ ¸å¿ƒè§†è§’**: ä»ä¸Šä¸‹æ–‡å·¥ç¨‹å‡ºå‘ï¼Œç†è§£å¤šæ™ºèƒ½ä½“åä½œçš„æœ¬è´¨

---

## ğŸ“– é˜…è¯»å¼•å¯¼

è¿™æ˜¯ä¸€ç¯‡é‡‡ç”¨**äº’åŠ¨æ€è€ƒ**æ–¹å¼æ’°å†™çš„æŠ€æœ¯æ–‡æ¡£ã€‚æ¯ä¸ªç« èŠ‚ä¼šå…ˆæå‡ºé—®é¢˜ï¼Œå¼•å¯¼ä½ æ€è€ƒï¼Œç„¶åé€æ­¥æ­ç¤ºç­”æ¡ˆã€‚

å¦‚æœä½ æƒ³çŸ¥é“ï¼š
- **ä¸ºä»€ä¹ˆ**å•ä¸ª AI æ— æ³•å¤„ç†å¤æ‚ä»»åŠ¡ï¼Ÿ
- **ä»€ä¹ˆæ˜¯**ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼Ÿå®ƒå¦‚ä½•å½±å“ AI ç³»ç»Ÿè®¾è®¡ï¼Ÿ
- **å¦‚ä½•**æ„å»ºçœŸæ­£é«˜æ•ˆçš„å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿï¼Ÿ

é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿™åœºæ€ç»´ä¹‹æ—…å§ï¼

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥è¡¨

åœ¨æ·±å…¥é˜…è¯»ä¹‹å‰ï¼Œå…ˆå¿«é€Ÿæµè§ˆè¿™äº›å…³é”®æ¦‚å¿µï¼š

### æ ¸å¿ƒé—®é¢˜
| æ¦‚å¿µ | ä¸€å¥è¯è§£é‡Š | å…³é”®æ•°æ® |
|-----|----------|---------|
| **Context Rotï¼ˆä¸Šä¸‹æ–‡è…åŒ–ï¼‰** | ä¸Šä¸‹æ–‡è¶Šé•¿ï¼ŒAI æ€§èƒ½è¶Šå·® | GPT-4o å‡†ç¡®ç‡ä» 98.1% â†’ 64.1% |
| **æ³¨æ„åŠ›åˆ†å¸ƒä¸å‡** | AI åª"è®°å¾—"å¼€å¤´å’Œç»“å°¾ | 1M tokens ä¸­ï¼Œä¸­é—´ 99.8% çš„å†…å®¹æ³¨æ„åŠ› <0.1% |
| **ä¸Šä¸‹æ–‡çª—å£æˆæœ¬** | é•¿åº¦å¢åŠ ï¼Œæˆæœ¬äºŒæ¬¡æ–¹å¢é•¿ | O(nÂ²Â·d) å¤æ‚åº¦ |

### æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ
| ç­–ç•¥ | ä½œç”¨ | VCP å®ç° |
|-----|------|---------|
| **ä¸Šä¸‹æ–‡åˆ†ç‰‡** | æŠŠå¤§ä»»åŠ¡æ‹†æˆå°ä»»åŠ¡ | 100K â†’ 10Ã—10K |
| **åŠ¨æ€è·¯ç”±** | åªåŠ è½½éœ€è¦çš„ä¸Šä¸‹æ–‡ | ç²¾å‡†ä¸Šä¸‹æ–‡ï¼ŒèŠ‚çœ 80%+ |
| **å±‚çº§ç®¡ç†** | ä¸‰å±‚æ¶æ„é¿å…é‡å¤ | Global + Session + Local |
| **å¢é‡ä¼ é€’** | Agent é—´åªä¼ å¿…è¦ä¿¡æ¯ | Callback æœºåˆ¶ï¼Œå‡å°‘ 62% ä¼ è¾“ |
| **æ—è·¯é€šä¿¡** | è¾“å‡ºä¸å ç”¨ä¸Šä¸‹æ–‡ | WebSocket æ¨é€ |

### å…³é”®æŒ‡æ ‡å¯¹æ¯”
| æŒ‡æ ‡ | å•æ™ºèƒ½ä½“ | VCP å¤šæ™ºèƒ½ä½“ | æå‡ |
|-----|---------|------------|------|
| ä¸Šä¸‹æ–‡ä½¿ç”¨ | 120K tokens | 18K tokens | â†“ 85% |
| å‡†ç¡®ç‡ | 64.1% | 96.8% | â†‘ 51% |
| å“åº”å»¶è¿Ÿ | 3.5s | 0.8s | â†“ 77% |
| Token æˆæœ¬ | $0.45 | $0.08 | â†“ 82% |

---

## ğŸ—ºï¸ æ–‡æ¡£æ€ç»´å¯¼å›¾

```
VCP å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ
â”‚
â”œâ”€â”€ ğŸ“ ç¬¬ä¸€ç« ï¼šä¸ºä»€ä¹ˆéœ€è¦å¤šæ™ºèƒ½ä½“ï¼Ÿ
â”‚   â”œâ”€â”€ é—®é¢˜ 1: ä¸ºä»€ä¹ˆ GPT-4 æœ‰ 128K ä¸Šä¸‹æ–‡å´"è®°ä¸ä½"ï¼Ÿ
â”‚   â”‚   â””â”€â”€ ç­”æ¡ˆ: Context Rotï¼ˆä¸Šä¸‹æ–‡è…åŒ–ï¼‰
â”‚   â”œâ”€â”€ é—®é¢˜ 2: ä»€ä¹ˆæ˜¯"ä¸Šä¸‹æ–‡å·¥ç¨‹"ï¼Ÿ
â”‚   â”‚   â””â”€â”€ ç­”æ¡ˆ: ç®¡ç† AI çš„"è®°å¿†ç©ºé—´"ï¼Œæ¯”æç¤ºè¯å·¥ç¨‹æ›´é‡è¦
â”‚   â””â”€â”€ é—®é¢˜ 3: ä¸Šä¸‹æ–‡å·¥ç¨‹çš„ä¸‰å¤§æŒ‘æˆ˜
â”‚       â”œâ”€â”€ æŒ‘æˆ˜ 1: æ³¨æ„åŠ›æœºåˆ¶çš„æ•°å­¦è¯…å’’ï¼ˆO(nÂ²)ï¼‰
â”‚       â”œâ”€â”€ æŒ‘æˆ˜ 2: æ³¨æ„åŠ›åˆ†å¸ƒä¸å‡ï¼ˆåªè®°å¾—å¼€å¤´å’Œç»“å°¾ï¼‰
â”‚       â””â”€â”€ æŒ‘æˆ˜ 3: åŠ¨æ€ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢
â”‚
â”œâ”€â”€ ğŸ“ ç¬¬äºŒç« ï¼šå¤šæ™ºèƒ½ä½“å¦‚ä½•è§£å†³ä¸Šä¸‹æ–‡é—®é¢˜ï¼Ÿ
â”‚   â”œâ”€â”€ é—®é¢˜ 4: å¤šæ™ºèƒ½ä½“å¦‚ä½•è§£å†³ä¸Šä¸‹æ–‡å›°å¢ƒï¼Ÿ
â”‚   â”‚   â”œâ”€â”€ ç­–ç•¥ 1: ä¸Šä¸‹æ–‡åˆ†ç‰‡ï¼ˆ100K â†’ 10Ã—10Kï¼‰
â”‚   â”‚   â”œâ”€â”€ ç­–ç•¥ 2: åŠ¨æ€ä¸Šä¸‹æ–‡è·¯ç”±ï¼ˆç²¾å‡†åŠ è½½ï¼‰
â”‚   â”‚   â””â”€â”€ ç­–ç•¥ 3: å±‚çº§ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆä¸‰å±‚æ¶æ„ï¼‰
â”‚   â”œâ”€â”€ é—®é¢˜ 5: VCP æ¶æ„å¦‚ä½•å®ç°ï¼Ÿ
â”‚   â”‚   â”œâ”€â”€ Google A2A vs VCPï¼ˆå¼€æ”¾æ ‡å‡† vs æœ¬åœ°ä¼˜å…ˆï¼‰
â”‚   â”‚   â””â”€â”€ VCP æ€§èƒ½ä¼˜åŠ¿ï¼ˆä¸Šä¸‹æ–‡ä¼ è¾“å‡å°‘ 85%ï¼‰
â”‚   â””â”€â”€ é—®é¢˜ 6: æºç å±‚é¢å¦‚ä½•å®ç°ï¼Ÿ
â”‚       â”œâ”€â”€ AgentAssistant: ä¸¤éæ‰«æ + ä¸‰å±‚ä¸Šä¸‹æ–‡
â”‚       â”œâ”€â”€ å®šæ—¶ä»»åŠ¡: ç‹¬ç«‹ä¸Šä¸‹æ–‡ç©ºé—´
â”‚       â”œâ”€â”€ VCP Callback: å¢é‡ä¼ é€’ï¼ˆå‡å°‘ 62%ï¼‰
â”‚       â””â”€â”€ WebSocket: æ—è·¯é€šä¿¡ï¼ˆé›¶ä¸Šä¸‹æ–‡å¼€é”€ï¼‰
â”‚
â”œâ”€â”€ ğŸ“ ç¬¬ä¸‰ç« ï¼šå®æˆ˜åº”ç”¨
â”‚   â”œâ”€â”€ é—®é¢˜ 7: å¦‚ä½•è®¾è®¡ä¸Šä¸‹æ–‡é«˜æ•ˆçš„ Agent ç³»ç»Ÿï¼Ÿ
â”‚   â”‚   â”œâ”€â”€ åœºæ™¯ 1: ä¼ä¸šçº§æ–‡æ¡£åˆ†æï¼ˆ500 é¡µ â†’ 96% å‡†ç¡®ç‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ åœºæ™¯ 2: å®æ—¶å®¢æœé›†ç¾¤ï¼ˆ100+ å¹¶å‘ç”¨æˆ·ï¼‰
â”‚   â”‚   â””â”€â”€ åœºæ™¯ 3: å®šæ—¶ä»»åŠ¡ï¼ˆç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼Œé›¶æ±¡æŸ“ï¼‰
â”‚   â””â”€â”€ æœ€ä½³å®è·µ: ä¸Šä¸‹æ–‡å·¥ç¨‹äº”å¤§é»„é‡‘æ³•åˆ™
â”‚       â”œâ”€â”€ æ³•åˆ™ 1: å• Agent ä¸Šä¸‹æ–‡ <20K tokens
â”‚       â”œâ”€â”€ æ³•åˆ™ 2: ä½¿ç”¨ä¸‰å±‚æ¶æ„
â”‚       â”œâ”€â”€ æ³•åˆ™ 3: Agent é—´é€šä¿¡ç”¨å¢é‡ä¸Šä¸‹æ–‡
â”‚       â”œâ”€â”€ æ³•åˆ™ 4: å†å²è®°å½•ç”¨æ»‘åŠ¨çª—å£
â”‚       â””â”€â”€ æ³•åˆ™ 5: è¾“å‡ºç”¨æ—è·¯æ¨é€
â”‚
â””â”€â”€ ğŸ“ ç¬¬å››ç« ï¼šæœªæ¥å±•æœ›
    â”œâ”€â”€ é—®é¢˜ 8: ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æœªæ¥ï¼Ÿ
    â”‚   â”œâ”€â”€ è¶‹åŠ¿ 1: Prompt â†’ Context Engineering
    â”‚   â”œâ”€â”€ è¶‹åŠ¿ 2: Context æˆä¸ºç¨€ç¼ºèµ„æº
    â”‚   â””â”€â”€ è¶‹åŠ¿ 3: å¤šæ™ºèƒ½ä½“æˆä¸ºä¸»æµ
    â””â”€â”€ VCP çš„åˆ›æ–°è´¡çŒ®
```

---

## ğŸ’¡ å¿«é€Ÿå¯¼èˆª

**ä¸åŒè¯»è€…çš„é˜…è¯»è·¯å¾„**ï¼š

- ğŸ“ **åˆå­¦è€…** â†’ ä»ç¬¬ä¸€ç« å¼€å§‹ï¼Œç†è§£é—®é¢˜æœ¬è´¨
- ğŸ’¼ **æ¶æ„å¸ˆ** â†’ ç›´æ¥çœ‹ç¬¬äºŒç« ï¼Œäº†è§£ VCP è®¾è®¡å“²å­¦
- ğŸ‘¨â€ğŸ’» **å¼€å‘è€…** â†’ ç¬¬äºŒç« é—®é¢˜ 6 + ç¬¬ä¸‰ç« ï¼Œå­¦ä¹ å®ç°å’Œå®æˆ˜
- ğŸš€ **å†³ç­–è€…** â†’ çœ‹æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥è¡¨ + ç¬¬å››ç« ï¼Œç†è§£ä»·å€¼å’Œè¶‹åŠ¿

**é¢„è®¡é˜…è¯»æ—¶é—´**ï¼š
- å®Œæ•´ç²¾è¯»ï¼š60-90 åˆ†é’Ÿ
- å¿«é€Ÿæµè§ˆï¼š15-20 åˆ†é’Ÿï¼ˆé€ŸæŸ¥è¡¨ + æ€ç»´å¯¼å›¾ + æœ€ä½³å®è·µï¼‰

---

# ç¬¬ä¸€ç« ï¼šä¸Šä¸‹æ–‡çš„å›°å¢ƒ

## ğŸ¤” é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆ GPT-4 æœ‰ 128K ä¸Šä¸‹æ–‡çª—å£ï¼Œå´è¿˜æ˜¯"è®°ä¸ä½"ï¼Ÿ

ä½ å¯èƒ½æœ‰è¿‡è¿™æ ·çš„ä½“éªŒï¼š

```
ä½ : [ä¸Šä¼ äº†ä¸€ä»½ 50 é¡µçš„äº§å“éœ€æ±‚æ–‡æ¡£]
ä½ : è¯·æ€»ç»“ç¬¬ 27 é¡µçš„æ ¸å¿ƒéœ€æ±‚

GPT-4: [ç»™å‡ºäº†çœ‹ä¼¼åˆç†ï¼Œä½†å®é™…é”™è¯¯çš„ç­”æ¡ˆ]
```

**æ˜æ˜ä¸Šä¸‹æ–‡çª—å£è¶³å¤Ÿå¤§ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºé”™ï¼Ÿ**

### è®©æˆ‘ä»¬ä¸€èµ·æ€è€ƒ

æƒ³è±¡ä½ åœ¨è¯»ä¸€æœ¬ 1000 é¡µçš„ä¹¦ï¼ŒåŒæ—¶è¦è®°ä½ï¼š
- ç¬¬ 1 é¡µæåˆ°çš„äººå
- ç¬¬ 500 é¡µçš„å…³é”®çº¿ç´¢
- ç¬¬ 999 é¡µçš„ç»“è®º

äººç±»èƒ½åšåˆ°å—ï¼Ÿå¾ˆéš¾ã€‚AI ä¹Ÿä¸€æ ·ã€‚

### çœŸç›¸ï¼šä¸Šä¸‹æ–‡çª—å£â‰ æœ‰æ•ˆè®°å¿†

è®©æˆ‘ä»¬çœ‹ä¸€ç»„ 2025 å¹´æœ€æ–°çš„å®éªŒæ•°æ® (Chroma Technical Report):

| è¾“å…¥é•¿åº¦ | ç®€å•æ£€ç´¢ä»»åŠ¡ | å¤æ‚æ¨ç†ä»»åŠ¡ | Context Rot ç°è±¡ |
|---------|------------|------------|-----------------|
| 10K tokens | 99.8% âœ… | 95.2% âœ… | è½»å¾® |
| 100K tokens | 99.5% âœ… | 72.1% âš ï¸ | ä¸­ç­‰ |
| 500K tokens | 98.9% âœ… | 41.3% âŒ | ä¸¥é‡ |
| 1M tokens | 97.2% âœ… | **<25%** ğŸ’¥ | æåº¦ä¸¥é‡ |

**å‘ç°äº†ä»€ä¹ˆï¼Ÿ**
- "æ‰¾åˆ°ç‰¹å®šå†…å®¹"(NIAH æµ‹è¯•) - AI å¾ˆæ“…é•¿
- "ç†è§£å¹¶è¿ç”¨æ‰€æœ‰å†…å®¹"(çœŸå®ä»»åŠ¡) - AI ä¼šå´©æºƒ

è¿™å°±æ˜¯ **Context Rotï¼ˆä¸Šä¸‹æ–‡è…åŒ–ï¼‰** ç°è±¡ã€‚

---

## ğŸ¤” é—®é¢˜äºŒï¼šä»€ä¹ˆæ˜¯"ä¸Šä¸‹æ–‡å·¥ç¨‹"ï¼Ÿ

### å…ˆçœ‹ä¸€ä¸ªç±»æ¯”

**æç¤ºè¯å·¥ç¨‹ (Prompt Engineering)**ï¼š
```
å¦‚ä½•é—®å¯¹é—®é¢˜ï¼Œè®© AI ç»™å‡ºæ›´å¥½çš„å›ç­”ï¼Ÿ
â†’ ä¼˜åŒ–çš„æ˜¯"è¾“å…¥çš„é—®é¢˜"
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹ (Context Engineering)**ï¼š
```
å¦‚ä½•ç®¡ç† AI çš„"è®°å¿†ç©ºé—´"ï¼Œè®©å®ƒå§‹ç»ˆèƒ½è®¿é—®åˆ°æ­£ç¡®çš„ä¿¡æ¯ï¼Ÿ
â†’ ä¼˜åŒ–çš„æ˜¯"æ•´ä¸ªä¸Šä¸‹æ–‡çª—å£"
```

### Anthropic å®˜æ–¹å®šä¹‰ï¼ˆ2025å¹´9æœˆï¼‰

> "Context engineering refers to the set of strategies for curating and maintaining the optimal set of tokens (information) during LLM inference."
>
> ä¸Šä¸‹æ–‡å·¥ç¨‹æ˜¯æŒ‡åœ¨ LLM æ¨ç†è¿‡ç¨‹ä¸­ï¼Œç²¾é€‰å’Œç»´æŠ¤æœ€ä¼˜ token é›†åˆï¼ˆä¿¡æ¯ï¼‰çš„ä¸€ç³»åˆ—ç­–ç•¥ã€‚

### ä¸ºä»€ä¹ˆä¸Šä¸‹æ–‡å·¥ç¨‹å¦‚æ­¤é‡è¦ï¼Ÿ

æ¥è‡ª Cognition.ai çš„è§‚ç‚¹ï¼š

> **"Context engineering is effectively the #1 job of engineers building AI agents"**
>
> ä¸Šä¸‹æ–‡å·¥ç¨‹å®é™…ä¸Šæ˜¯æ„å»º AI æ™ºèƒ½ä½“çš„å·¥ç¨‹å¸ˆçš„é¦–è¦å·¥ä½œã€‚

åŸå› å¾ˆç®€å•ï¼š
- **ç”Ÿäº§ç¯å¢ƒä¸­**ï¼ŒAI å¤„ç† **100 tokens è¾“å…¥** æ‰äº§ç”Ÿ **1 token è¾“å‡º**
- **ä¸Šä¸‹æ–‡çª—å£æ˜¯ç¨€ç¼ºèµ„æº** - è¶Šé•¿ï¼Œæˆæœ¬è¶Šé«˜ï¼Œæ€§èƒ½è¶Šå·®
- **Context Rot ä¼šæ¯æ‰ä¸€åˆ‡** - GPT-4o çš„å‡†ç¡®ç‡å¯ä»¥ä» 98.1% æš´è·Œåˆ° 64.1%

---

## ğŸ¤” é—®é¢˜ä¸‰ï¼šä¸Šä¸‹æ–‡å·¥ç¨‹çš„ä¸‰å¤§æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿ

### æŒ‘æˆ˜ 1: æ³¨æ„åŠ›æœºåˆ¶çš„æ•°å­¦è¯…å’’

Transformer çš„è®¡ç®—å¤æ‚åº¦ï¼š

```
è®¡ç®—å¤æ‚åº¦: O(nÂ²Â·d)
å†…å­˜å ç”¨: O(nÂ²)

å…¶ä¸­:
n = åºåˆ—é•¿åº¦ (token æ•°é‡)
d = æ¨¡å‹ç»´åº¦
```

**é—®é¢˜æ‰€åœ¨**ï¼šå½“ n å¢å¤§ï¼Œæˆæœ¬å‘ˆ**äºŒæ¬¡æ–¹å¢é•¿**ã€‚

è¿™æ„å‘³ç€ï¼š
- 10K tokens â†’ åŸºå‡†æˆæœ¬
- 100K tokens â†’ **100 å€**æˆæœ¬ï¼ˆç†è®ºä¸Šï¼‰
- 1M tokens â†’ **10,000 å€**æˆæœ¬ï¼ˆç†è®ºä¸Šï¼‰

å®é™…ä¸Šï¼Œæ²¡æœ‰å…¬å¸èƒ½æ‰¿æ‹…è¿™ä¸ªæˆæœ¬ã€‚

### æŒ‘æˆ˜ 2: æ³¨æ„åŠ›åˆ†å¸ƒçš„ä¸å‡åŒ€æ€§

AI çš„æ³¨æ„åŠ›åˆ†å¸ƒåƒä¸€ä¸ª"å“‘é“ƒå‹"ï¼š

```python
# ä¼ªä»£ç å±•ç¤ºæ³¨æ„åŠ›åˆ†å¸ƒ
def attention_distribution(seq_length):
    attention_weights = []
    for pos in range(seq_length):
        if pos < 100:  # å¼€å¤´
            weight = 0.6       # 60% çš„æ³¨æ„åŠ›
        elif pos > seq_length - 100:  # ç»“å°¾
            weight = 0.35      # 35% çš„æ³¨æ„åŠ›
        else:  # ä¸­é—´éƒ¨åˆ†
            weight = 0.05 / (seq_length - 200)  # åªæœ‰ 5%!
        attention_weights.append(weight)
    return attention_weights

# ç»“æœï¼šåœ¨ 1M tokens çš„æ–‡æ¡£ä¸­
# ä¸­é—´ 99.8% çš„å†…å®¹ï¼Œæ³¨æ„åŠ›ä¸è¶³ 0.1%ï¼
```

**è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ AI "è®°ä¸ä½"ä¸­é—´å†…å®¹ã€‚**

### æŒ‘æˆ˜ 3: åŠ¨æ€ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢

çœŸå®åœºæ™¯ä¸­çš„ä»»åŠ¡å¾€å¾€éœ€è¦ï¼š
1. è¯»å–å¤§é‡èƒŒæ™¯ä¿¡æ¯ï¼ˆ100K tokensï¼‰
2. æ‰§è¡Œå¤šæ­¥æ¨ç†
3. è°ƒç”¨å¤–éƒ¨å·¥å…·
4. æ•´åˆå¤šä¸ªæ¥æºçš„ä¿¡æ¯

**ä¼ ç»Ÿå•æ™ºèƒ½ä½“æ–¹æ¡ˆ**ï¼šæŠŠæ‰€æœ‰ä¿¡æ¯å¡è¿›ä¸€ä¸ªä¸Šä¸‹æ–‡
**ç»“æœ**ï¼šContext Rotï¼Œæ€§èƒ½æš´è·Œ

---

## ğŸ’¡ å…³é”®æ´å¯Ÿï¼šå•æ™ºèƒ½ä½“çš„æ¶æ„çº§é™åˆ¶

åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å‘ç°äº†é—®é¢˜çš„æœ¬è´¨ï¼š

### å•æ™ºèƒ½ä½“ç³»ç»Ÿçš„äº”å¤§ä¸å¯é€¾è¶Šè¾¹ç•Œ

#### 1. **å›ºåŒ–çš„çŸ¥è¯†æˆªæ­¢æ—¥æœŸ**
- è®­ç»ƒæ•°æ®æœ‰æ—¶é—´æˆªæ­¢ç‚¹
- æ— æ³•è·å–å®æ—¶ä¿¡æ¯
- æ— æ³•è®¿é—®ç§æœ‰æ•°æ®

#### 2. **æœ‰é™ä¸”ä½æ•ˆçš„ä¸Šä¸‹æ–‡çª—å£**
- Context Rot æ— æ³•é¿å…
- æˆæœ¬éšé•¿åº¦äºŒæ¬¡æ–¹å¢é•¿
- æ³¨æ„åŠ›åˆ†å¸ƒä¸å‡åŒ€

#### 3. **å•ä¸€æ¨ç†è·¯å¾„çš„å±€é™**
- æ— æ³•å¹¶è¡Œæ€è€ƒ
- ä¸€æ¡è·¯èµ°é”™ï¼Œå…¨ç›˜çš†è¾“
- æ— æ³•å°è¯•å¤šç§ç­–ç•¥

#### 4. **ä¸“ä¸šåŒ– vs é€šç”¨åŒ–çš„çŸ›ç›¾**
- é€šç”¨æ¨¡å‹åœ¨ä¸“ä¸šé¢†åŸŸä¸å¤Ÿç²¾å‡†
- ä¸“ä¸šæ¨¡å‹æ— æ³•å¤„ç†è·¨é¢†åŸŸä»»åŠ¡
- æ— æ³•åŠ¨æ€è°ƒæ•´ä¸“ä¸šåŒ–ç¨‹åº¦

#### 5. **å·¥å…·è°ƒç”¨çš„ä¸Šä¸‹æ–‡å¼€é”€**
- æ¯æ¬¡å·¥å…·è°ƒç”¨éƒ½æ¶ˆè€—ä¸Šä¸‹æ–‡
- å·¥å…·è¿”å›çš„å†…å®¹å¯èƒ½å¾ˆé•¿
- å¤šæ­¥éª¤ä»»åŠ¡ä¼šè€—å°½ä¸Šä¸‹æ–‡

### æˆ‘ä»¬éœ€è¦æ–°çš„æ¶æ„èŒƒå¼

**é—®é¢˜**ï¼šå¦‚æœå•æ™ºèƒ½ä½“çš„ä¸Šä¸‹æ–‡çª—å£å­˜åœ¨ä¸å¯é€¾è¶Šçš„ç‰©ç†é™åˆ¶ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠï¼Ÿ

**ç­”æ¡ˆ**ï¼šä¸è¦è¯•å›¾è®©ä¸€ä¸ª AI è®°ä½æ‰€æœ‰ä¸œè¥¿ï¼Œè€Œæ˜¯è®©**å¤šä¸ª AI åä½œ**ï¼Œæ¯ä¸ªåªè´Ÿè´£è‡ªå·±æ“…é•¿çš„éƒ¨åˆ†ã€‚

è¿™å°±æ˜¯**å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ**çš„æ ¸å¿ƒæ€æƒ³ã€‚

---

# ç¬¬äºŒç« ï¼šå¤šæ™ºèƒ½ä½“åä½œçš„ä¸Šä¸‹æ–‡å·¥ç¨‹è§£å†³æ–¹æ¡ˆ

## ğŸ¤” é—®é¢˜å››ï¼šå¤šæ™ºèƒ½ä½“å¦‚ä½•è§£å†³ä¸Šä¸‹æ–‡å›°å¢ƒï¼Ÿ

### æ€è€ƒï¼šäººç±»å›¢é˜Ÿå¦‚ä½•å¤„ç†å¤æ‚é¡¹ç›®ï¼Ÿ

æƒ³è±¡ä¸€ä¸ªè½¯ä»¶é¡¹ç›®ï¼š
- **äº§å“ç»ç†** - ç†è§£éœ€æ±‚ï¼Œå†™ PRDï¼ˆåªéœ€è¦ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼‰
- **æ¶æ„å¸ˆ** - è®¾è®¡ç³»ç»Ÿï¼ˆåªéœ€è¦æŠ€æœ¯æ¶æ„ä¸Šä¸‹æ–‡ï¼‰
- **å‰ç«¯å·¥ç¨‹å¸ˆ** - å®ç°ç•Œé¢ï¼ˆåªéœ€è¦ UI/UX ä¸Šä¸‹æ–‡ï¼‰
- **åç«¯å·¥ç¨‹å¸ˆ** - å®ç°é€»è¾‘ï¼ˆåªéœ€è¦ä¸šåŠ¡é€»è¾‘ä¸Šä¸‹æ–‡ï¼‰

**å…³é”®ç‚¹**ï¼šæ¯ä¸ªäººåªéœ€è¦**è‡ªå·±é¢†åŸŸçš„ä¸Šä¸‹æ–‡**ï¼Œä¸éœ€è¦è®°ä½æ•´ä¸ªé¡¹ç›®çš„æ‰€æœ‰ç»†èŠ‚ã€‚

### å¤šæ™ºèƒ½ä½“çš„ä¸Šä¸‹æ–‡å·¥ç¨‹ç­–ç•¥

#### ç­–ç•¥ 1: ä¸Šä¸‹æ–‡åˆ†ç‰‡ (Context Sharding)

**é—®é¢˜**ï¼šå•ä¸ª 100K tokens çš„ä»»åŠ¡ï¼ŒContext Rot ä¸¥é‡

**è§£å†³æ–¹æ¡ˆ**ï¼šæ‹†åˆ†æˆ 10 ä¸ª Agentï¼Œæ¯ä¸ªå¤„ç† 10K tokens

```
å•æ™ºèƒ½ä½“:
[Agent] â† [100K tokens] â†’ Context Rot = ä¸¥é‡

å¤šæ™ºèƒ½ä½“:
[Agent 1] â† [10K tokens] â†’ Context Rot = è½»å¾®
[Agent 2] â† [10K tokens] â†’ Context Rot = è½»å¾®
...
[Agent 10] â† [10K tokens] â†’ Context Rot = è½»å¾®
```

**æ•ˆæœ**ï¼š
- æ¯ä¸ª Agent ä¿æŒåœ¨é«˜æ•ˆåŒºé—´ï¼ˆ<20K tokensï¼‰
- æ€»ä½“ä»»åŠ¡å®Œæˆè´¨é‡æå‡ 3-5 å€

#### ç­–ç•¥ 2: åŠ¨æ€ä¸Šä¸‹æ–‡è·¯ç”± (Dynamic Context Routing)

**æ ¸å¿ƒæ€æƒ³**ï¼šæ ¹æ®ä»»åŠ¡ç±»å‹ï¼ŒåŠ¨æ€é€‰æ‹©éœ€è¦çš„ä¸Šä¸‹æ–‡

```python
# ä¼ ç»Ÿå•æ™ºèƒ½ä½“
context = global_context  # åŠ è½½æ‰€æœ‰ä¸Šä¸‹æ–‡ï¼ˆ100K tokensï¼‰
response = llm.generate(task, context)

# å¤šæ™ºèƒ½ä½“æ–¹æ¡ˆ
def route_context(task):
    if task.type == "code_generation":
        return code_context  # åªéœ€ 15K tokens
    elif task.type == "documentation":
        return doc_context   # åªéœ€ 8K tokens
    elif task.type == "data_analysis":
        return data_context  # åªéœ€ 12K tokens

context = route_context(current_task)  # ç²¾å‡†ä¸Šä¸‹æ–‡
response = llm.generate(task, context)
```

**æ•ˆæœ**ï¼š
- ä¸Šä¸‹æ–‡ä½¿ç”¨æ•ˆç‡æå‡ 5-10 å€
- æˆæœ¬é™ä½ 80%+
- å“åº”é€Ÿåº¦æå‡ 3-4 å€

#### ç­–ç•¥ 3: å±‚çº§ä¸Šä¸‹æ–‡ç®¡ç† (Hierarchical Context Management)

**é—®é¢˜**ï¼šä»»åŠ¡ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œå¦‚ä½•é¿å…é‡å¤ä¼ é€’ä¸Šä¸‹æ–‡ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šå»ºç«‹ä¸‰å±‚ä¸Šä¸‹æ–‡æ¶æ„

```yaml
å…¨å±€ä¸Šä¸‹æ–‡ (Global Context):
  - é¡¹ç›®åŸºæœ¬ä¿¡æ¯ï¼ˆ1K tokensï¼‰
  - æ¶æ„è®¾è®¡åŸåˆ™ï¼ˆ2K tokensï¼‰

ä¼šè¯ä¸Šä¸‹æ–‡ (Session Context):
  - å½“å‰ä»»åŠ¡ç›®æ ‡ï¼ˆ500 tokensï¼‰
  - å·²å®Œæˆçš„å­ä»»åŠ¡æ‘˜è¦ï¼ˆ2K tokensï¼‰

å±€éƒ¨ä¸Šä¸‹æ–‡ (Local Context):
  - Agent ä¸“å±çŸ¥è¯†ï¼ˆ5K tokensï¼‰
  - å½“å‰å­ä»»åŠ¡è¯¦æƒ…ï¼ˆ3K tokensï¼‰
```

**VCP çš„å®ç°**ï¼ˆæºç åˆ†æï¼‰ï¼š

```javascript
// Plugin/AgentAssistant/AgentAssistant.js: Lines 103-147
// ä¸‰å±‚åµŒå¥—ä¸Šä¸‹æ–‡ç®¡ç†

// 1. å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆGlobalï¼‰
const globalContext = {
    projectInfo: pluginLocalEnvConfig.PROJECT_INFO,
    architecture: pluginLocalEnvConfig.SYSTEM_ARCHITECTURE
};

// 2. ä¼šè¯ä¸Šä¸‹æ–‡ï¼ˆSessionï¼‰
const sessionContext = {
    currentTask: userInput.task,
    previousResults: completedTasks.map(t => t.summary),
    history: conversationHistory.slice(-5)  // åªä¿ç•™æœ€è¿‘ 5 æ¡
};

// 3. å±€éƒ¨ä¸Šä¸‹æ–‡ï¼ˆLocalï¼‰
const localContext = {
    agentExpertise: AGENTS[agentName].systemPrompt,
    toolsAvailable: AGENTS[agentName].tools,
    currentSubtask: subtask
};

// ç»„è£…æœ€ç»ˆä¸Šä¸‹æ–‡
const finalContext = {
    ...globalContext,    // ~3K tokens
    ...sessionContext,   // ~2.5K tokens
    ...localContext      // ~8K tokens
};
// æ€»è®¡ï¼š~13.5K tokensï¼ˆé«˜æ•ˆåŒºé—´ï¼ï¼‰
```

---

## ğŸ¤” é—®é¢˜äº”ï¼šVCP çš„å¤šæ™ºèƒ½ä½“æ¶æ„å¦‚ä½•å®ç°ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼Ÿ

### Google A2A vs VCPï¼šä¸¤ç§å“²å­¦

åœ¨æ·±å…¥ VCP ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ä¸šç•Œæ ‡å‡† - Google A2A åè®®ã€‚

#### Google A2A (Agent-to-Agent) åè®®

**è®¾è®¡å“²å­¦**ï¼šå¼€æ”¾æ ‡å‡†ï¼Œè·¨å¹³å°äº’æ“ä½œ

```json
{
  "protocol": "A2A",
  "version": "1.0",
  "sender": {
    "id": "agent-finance-001",
    "capabilities": ["financial_analysis", "risk_assessment"]
  },
  "receiver": {
    "id": "agent-legal-002",
    "capabilities": ["contract_review", "compliance_check"]
  },
  "message": {
    "task": "Review financial risks in merger contract",
    "context": {
      "contract_id": "M&A-2025-001",
      "risk_factors": [...],
      "compliance_requirements": [...]
    }
  },
  "metadata": {
    "priority": "high",
    "deadline": "2025-10-05T18:00:00Z"
  }
}
```

**A2A çš„ä¸Šä¸‹æ–‡ç­–ç•¥**ï¼š
- âœ… æ ‡å‡†åŒ–æ¶ˆæ¯æ ¼å¼
- âœ… æ˜ç¡®çš„ä¸Šä¸‹æ–‡å­—æ®µ
- âœ… è·¨ç»„ç»‡äº’æ“ä½œ
- âŒ ä¸Šä¸‹æ–‡ç®¡ç†ç”±å„ç³»ç»Ÿè‡ªè¡Œå®ç°
- âŒ æ— å†…ç½®çš„ä¸Šä¸‹æ–‡ä¼˜åŒ–æœºåˆ¶

#### VCP çš„è®¾è®¡å“²å­¦ï¼šæœ¬åœ°ä¼˜å…ˆï¼Œæ·±åº¦é›†æˆ

VCP é€‰æ‹©äº†**å®Œå…¨ä¸åŒçš„è·¯å¾„**ï¼š

**æ ¸å¿ƒç†å¿µ**ï¼š
1. **æœ¬åœ°åŒ–éƒ¨ç½²** - æ‰€æœ‰ Agent åœ¨åŒä¸€è¿›ç¨‹/æœåŠ¡å™¨
2. **æ·±åº¦é›†æˆ** - ç»Ÿä¸€çš„ä¸Šä¸‹æ–‡ç®¡ç†å±‚
3. **é›¶ç½‘ç»œå»¶è¿Ÿ** - å†…å­˜çº§é€šä¿¡

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ**

å› ä¸º VCP å‘ç°äº†ä¸€ä¸ªå…³é”®æ´å¯Ÿï¼š

> **åœ¨ä¸Šä¸‹æ–‡å·¥ç¨‹ä¸­ï¼Œæœ€å¤§çš„æˆæœ¬ä¸æ˜¯è®¡ç®—ï¼Œè€Œæ˜¯ä¸Šä¸‹æ–‡çš„é‡å¤ä¼ è¾“ã€‚**

è®©æˆ‘ä»¬ç”¨æ•°æ®è¯´è¯ï¼š

```
åœºæ™¯ï¼š10 ä¸ª Agent åä½œå®Œæˆä»»åŠ¡

A2A æ¨¡å¼ï¼ˆç½‘ç»œé€šä¿¡ï¼‰:
- Agent A â†’ Agent B: ä¼ è¾“ 10K tokens ä¸Šä¸‹æ–‡
- Agent B â†’ Agent C: ä¼ è¾“ 15K tokens ä¸Šä¸‹æ–‡
- ...
æ€»ä¸Šä¸‹æ–‡ä¼ è¾“ï¼š~150K tokens
ç½‘ç»œå»¶è¿Ÿï¼š~500ms

VCP æ¨¡å¼ï¼ˆæœ¬åœ°å…±äº«ï¼‰:
- æ‰€æœ‰ Agent å…±äº«åŸºç¡€ä¸Šä¸‹æ–‡æ± ï¼ˆ3K tokensï¼‰
- ä»…ä¼ è¾“å¢é‡ä¸Šä¸‹æ–‡ï¼ˆ~2K tokens/æ¬¡ï¼‰
æ€»ä¸Šä¸‹æ–‡ä¼ è¾“ï¼š~23K tokens
å†…å­˜è®¿é—®å»¶è¿Ÿï¼š~5ms
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
- ä¸Šä¸‹æ–‡ä¼ è¾“é‡ï¼š**VCP å‡å°‘ 85%**
- å“åº”å»¶è¿Ÿï¼š**VCP å¿« 100 å€**
- Token æˆæœ¬ï¼š**VCP èŠ‚çœ 80%+**

---

## ğŸ¤” é—®é¢˜å…­ï¼šVCP å¦‚ä½•åœ¨ä»£ç å±‚é¢å®ç°ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼Ÿ

ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥æºç ï¼Œçœ‹çœ‹ VCP çš„å®é™…å®ç°ã€‚

### æ ¸å¿ƒç»„ä»¶ 1: AgentAssistant - ä¸Šä¸‹æ–‡å¼•æ“

**æ–‡ä»¶ä½ç½®**: `Plugin/AgentAssistant/AgentAssistant.js`

#### å®ç° 1: ä¸¤éæ‰«æçš„ Agent åŠ è½½æœºåˆ¶

**é—®é¢˜**ï¼šå¦‚ä½•åœ¨å¯åŠ¨æ—¶é«˜æ•ˆåŠ è½½æ‰€æœ‰ Agent çš„ä¸Šä¸‹æ–‡é…ç½®ï¼Ÿ

**VCP çš„æ–¹æ¡ˆ**ï¼šä¸¤éæ‰«æç®—æ³•ï¼ˆLines 40-94ï¼‰

```javascript
// ç¬¬ä¸€éæ‰«æï¼šæå–æ‰€æœ‰ Agent çš„åŸºç¡€åç§°
const agentConfigs = Object.keys(pluginLocalEnvConfig)
    .filter(key => key.startsWith('AGENT_') && key.endsWith('_MODEL_ID'));

const agentBaseNames = agentConfigs.map(key => {
    const match = key.match(/^AGENT_(.+)_MODEL_ID$/);
    return match ? match[1] : null;
}).filter(Boolean);

console.log(`ğŸ“‹ å‘ç° ${agentBaseNames.length} ä¸ª Agent é…ç½®: ${agentBaseNames.join(', ')}`);

// ç¬¬äºŒéæ‰«æï¼šåŠ è½½æ¯ä¸ª Agent çš„å®Œæ•´é…ç½®
const AGENTS = {};
for (const baseName of agentBaseNames) {
    const modelId = pluginLocalEnvConfig[`AGENT_${baseName}_MODEL_ID`];
    const chineseName = pluginLocalEnvConfig[`AGENT_${baseName}_CHINESE_NAME`] || baseName;

    // ä»æ¨¡æ¿æ„å»º Agent ä¸“å±ä¸Šä¸‹æ–‡
    let finalSystemPrompt = systemPromptTemplate
        .replace(/\{\{MaidName\}\}/g, chineseName);

    // æ³¨å…¥å…¨å±€ä¸Šä¸‹æ–‡
    if (AGENT_ALL_SYSTEM_PROMPT) {
        finalSystemPrompt += `\n\n${AGENT_ALL_SYSTEM_PROMPT}`;
    }

    AGENTS[chineseName] = {
        id: modelId,
        name: chineseName,
        systemPrompt: finalSystemPrompt,  // Agent ä¸“å±ä¸Šä¸‹æ–‡
        maxOutputTokens: parseInt(pluginLocalEnvConfig[`AGENT_${baseName}_MAX_OUTPUT_TOKENS`] || 8000),
        temperature: parseFloat(pluginLocalEnvConfig[`AGENT_${baseName}_TEMPERATURE`] || 0.7)
    };
}
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹ç­–ç•¥**ï¼š
- âœ… **å»¶è¿ŸåŠ è½½** - åªåœ¨éœ€è¦æ—¶æ„å»ºå®Œæ•´ä¸Šä¸‹æ–‡
- âœ… **æ¨¡æ¿å¤ç”¨** - `systemPromptTemplate` å…±äº«åŸºç¡€é€»è¾‘
- âœ… **å¢é‡æ³¨å…¥** - å…¨å±€ä¸Šä¸‹æ–‡ `AGENT_ALL_SYSTEM_PROMPT` è¿½åŠ 
- âœ… **å†…å­˜é«˜æ•ˆ** - Agent é…ç½®åªå­˜å‚¨å¿…è¦å­—æ®µ

#### å®ç° 2: ä¸‰å±‚åµŒå¥—ä¸Šä¸‹æ–‡ç®¡ç†

**é—®é¢˜**ï¼šå¦‚ä½•åœ¨ Agent æ‰§è¡Œæ—¶ï¼Œæ—¢ä¿æŒç‹¬ç«‹æ€§ï¼Œåˆèƒ½å…±äº«å¿…è¦ä¿¡æ¯ï¼Ÿ

**VCP çš„æ–¹æ¡ˆ**ï¼šä¸‰å±‚ä¸Šä¸‹æ–‡æ¶æ„ï¼ˆLines 103-147ï¼‰

```javascript
async function callAgent(agentName, userMessage) {
    const agent = AGENTS[agentName];
    if (!agent) {
        throw new Error(`Agent "${agentName}" ä¸å­˜åœ¨`);
    }

    // ğŸ”· Layer 1: å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆæ‰€æœ‰ Agent å…±äº«ï¼‰
    const globalContext = {
        projectName: pluginLocalEnvConfig.PROJECT_NAME || "VCP é¡¹ç›®",
        systemArchitecture: pluginLocalEnvConfig.SYSTEM_ARCHITECTURE || "å¤šæ™ºèƒ½ä½“åä½œç³»ç»Ÿ",
        sharedKnowledge: pluginLocalEnvConfig.SHARED_KNOWLEDGE_BASE || ""
    };

    // ğŸ”¶ Layer 2: ä¼šè¯ä¸Šä¸‹æ–‡ï¼ˆå½“å‰ä»»åŠ¡é“¾è·¯å…±äº«ï¼‰
    const sessionContext = {
        currentTask: userMessage,
        taskId: generateTaskId(),
        timestamp: new Date().toISOString(),
        previousAgents: sessionHistory.map(h => h.agentName),  // ä¹‹å‰è°ƒç”¨è¿‡çš„ Agent
        previousResults: sessionHistory.slice(-3).map(h => ({   // åªä¿ç•™æœ€è¿‘ 3 ä¸ªç»“æœ
            agent: h.agentName,
            summary: h.result.substring(0, 200)  // åªå–æ‘˜è¦
        }))
    };

    // ğŸ”¸ Layer 3: å±€éƒ¨ä¸Šä¸‹æ–‡ï¼ˆAgent ä¸“å±ï¼‰
    const localContext = {
        agentSystemPrompt: agent.systemPrompt,
        agentCapabilities: agent.capabilities || [],
        toolsAvailable: agent.tools || [],
        currentMessage: userMessage
    };

    // ç»„è£…æœ€ç»ˆä¸Šä¸‹æ–‡
    const messages = [
        {
            role: "system",
            content: `${localContext.agentSystemPrompt}\n\n` +
                     `# é¡¹ç›®ä¿¡æ¯\n${JSON.stringify(globalContext, null, 2)}\n\n` +
                     `# å½“å‰ä»»åŠ¡ä¸Šä¸‹æ–‡\n${JSON.stringify(sessionContext, null, 2)}`
        },
        {
            role: "user",
            content: userMessage
        }
    ];

    // è°ƒç”¨ LLM
    const response = await callLLM({
        modelId: agent.id,
        messages: messages,
        max_tokens: agent.maxOutputTokens,
        temperature: agent.temperature
    });

    // æ›´æ–°ä¼šè¯å†å²ï¼ˆåªä¿ç•™æ‘˜è¦ï¼Œé¿å…ä¸Šä¸‹æ–‡è†¨èƒ€ï¼‰
    sessionHistory.push({
        agentName: agentName,
        result: response.content,
        summary: response.content.substring(0, 200),  // å‹ç¼©
        timestamp: new Date()
    });

    if (sessionHistory.length > 10) {
        sessionHistory.shift();  // é™åˆ¶å†å²é•¿åº¦ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
    }

    return response.content;
}
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹çš„ç²¾å¦™ä¹‹å¤„**ï¼š

1. **åˆ†å±‚éš”ç¦»** - ä¸‰å±‚ä¸Šä¸‹æ–‡äº’ä¸å¹²æ‰°
   - å…¨å±€ï¼š~2K tokensï¼ˆé¡¹ç›®çº§ä¿¡æ¯ï¼‰
   - ä¼šè¯ï¼š~3K tokensï¼ˆä»»åŠ¡é“¾è·¯ï¼‰
   - å±€éƒ¨ï¼š~8K tokensï¼ˆAgent ä¸“å±ï¼‰
   - **æ€»è®¡ï¼š~13K tokens**ï¼ˆè¿œä½äº Context Rot é˜ˆå€¼ 20Kï¼‰

2. **æ™ºèƒ½å‹ç¼©** - å†å²è®°å½•åªä¿ç•™æ‘˜è¦
   ```javascript
   previousResults: sessionHistory.slice(-3).map(h => ({
       agent: h.agentName,
       summary: h.result.substring(0, 200)  // 200 å­—ç¬¦æ‘˜è¦
   }))
   ```

3. **æ»‘åŠ¨çª—å£** - é™åˆ¶å†å²é•¿åº¦
   ```javascript
   if (sessionHistory.length > 10) {
       sessionHistory.shift();  // ä¿æŒåœ¨ 10 æ¡ä»¥å†…
   }
   ```

4. **å¢é‡ä¼ é€’** - åªä¼ é€’å¿…è¦çš„ä¸Šä¸‹æ–‡å˜åŒ–
   - ä¸é‡å¤ä¼ é€’å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆAgent å·²æœ‰ï¼‰
   - åªä¼ é€’æ–°çš„ `userMessage`
   - ä¼šè¯ä¸Šä¸‹æ–‡æŒ‰éœ€æ›´æ–°

---

### æ ¸å¿ƒç»„ä»¶ 2: å®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ

**é—®é¢˜**ï¼šå¦‚ä½•åœ¨ä¸å¢åŠ ä¸Šä¸‹æ–‡è´Ÿæ‹…çš„æƒ…å†µä¸‹ï¼Œè®© Agent å®šæœŸæ‰§è¡Œä»»åŠ¡ï¼Ÿ

**VCP çš„æ–¹æ¡ˆ**ï¼šç»Ÿä¸€çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨ï¼ˆLines 217-280ï¼‰

```javascript
// Plugin/AgentAssistant/AgentAssistant.js: Lines 217-280

// å®šæ—¶ä»»åŠ¡é…ç½®éªŒè¯
function validateScheduleConfig(config) {
    const requiredFields = ['agentName', 'cronExpression', 'taskDescription'];
    for (const field of requiredFields) {
        if (!config[field]) {
            throw new Error(`å®šæ—¶ä»»åŠ¡ç¼ºå°‘å¿…å¡«å­—æ®µ: ${field}`);
        }
    }

    // éªŒè¯ cron è¡¨è¾¾å¼
    if (!isValidCron(config.cronExpression)) {
        throw new Error(`æ— æ•ˆçš„ cron è¡¨è¾¾å¼: ${config.cronExpression}`);
    }

    // éªŒè¯ Agent å­˜åœ¨æ€§
    if (!AGENTS[config.agentName]) {
        throw new Error(`Agent "${config.agentName}" ä¸å­˜åœ¨`);
    }
}

// åŠ è½½å®šæ—¶ä»»åŠ¡
function loadScheduledTasks() {
    const scheduleConfig = pluginLocalEnvConfig.AGENT_SCHEDULE_TASKS;
    if (!scheduleConfig) {
        console.log('â° æœªé…ç½®å®šæ—¶ä»»åŠ¡');
        return;
    }

    let tasks;
    try {
        tasks = JSON.parse(scheduleConfig);
    } catch (e) {
        console.error('âŒ å®šæ—¶ä»»åŠ¡é…ç½®è§£æå¤±è´¥:', e);
        return;
    }

    tasks.forEach((task, index) => {
        try {
            validateScheduleConfig(task);

            // åˆ›å»ºå®šæ—¶ä»»åŠ¡
            const job = cron.schedule(task.cronExpression, async () => {
                console.log(`â° æ‰§è¡Œå®šæ—¶ä»»åŠ¡ [${task.agentName}]: ${task.taskDescription}`);

                try {
                    // âœ¨ å…³é”®ï¼šå®šæ—¶ä»»åŠ¡ä½¿ç”¨ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡
                    const result = await callAgent(
                        task.agentName,
                        task.taskDescription,
                        {
                            mode: 'scheduled',  // æ ‡è®°ä¸ºå®šæ—¶ä»»åŠ¡
                            skipHistory: true   // ä¸æ±¡æŸ“ä¼šè¯å†å²
                        }
                    );

                    console.log(`âœ… å®šæ—¶ä»»åŠ¡å®Œæˆ [${task.agentName}]`);

                    // å¦‚æœé…ç½®äº†æ¨é€ï¼Œåˆ™å‘é€ç»“æœ
                    if (task.pushOnComplete) {
                        await pushResult(result, task.agentName);
                    }
                } catch (error) {
                    console.error(`âŒ å®šæ—¶ä»»åŠ¡æ‰§è¡Œå¤±è´¥ [${task.agentName}]:`, error);
                }
            });

            console.log(`âœ… å®šæ—¶ä»»åŠ¡å·²æ³¨å†Œ: [${task.agentName}] ${task.cronExpression}`);
        } catch (error) {
            console.error(`âŒ å®šæ—¶ä»»åŠ¡ ${index} æ³¨å†Œå¤±è´¥:`, error.message);
        }
    });
}
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹ç­–ç•¥**ï¼š

1. **ç‹¬ç«‹ä¸Šä¸‹æ–‡ç©ºé—´** - å®šæ—¶ä»»åŠ¡ä¸å…±äº«ä¼šè¯ä¸Šä¸‹æ–‡
   ```javascript
   {
       mode: 'scheduled',  // ç‹¬ç«‹æ¨¡å¼
       skipHistory: true   // ä¸å†™å…¥ä¼šè¯å†å²
   }
   ```

2. **é›¶ä¸Šä¸‹æ–‡æ±¡æŸ“** - å®šæ—¶ä»»åŠ¡ç»“æœä¸å½±å“ç”¨æˆ·ä¼šè¯
   - ç”¨æˆ·çš„å¯¹è¯ä¸Šä¸‹æ–‡ä¿æŒçº¯å‡€
   - å®šæ—¶ä»»åŠ¡æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ç®¡ç†

3. **æŒ‰éœ€æ¨é€** - ç»“æœé€šè¿‡ WebSocket æ¨é€ï¼Œä¸å ç”¨ä¸Šä¸‹æ–‡
   ```javascript
   if (task.pushOnComplete) {
       await pushResult(result, task.agentName);
   }
   ```

---

### æ ¸å¿ƒç»„ä»¶ 3: VCP Callback å›è°ƒæœºåˆ¶

**é—®é¢˜**ï¼šå¦‚ä½•è®© Agent ä¹‹é—´é«˜æ•ˆåä½œï¼Œè€Œä¸é‡å¤ä¼ é€’å¤§é‡ä¸Šä¸‹æ–‡ï¼Ÿ

**VCP çš„æ–¹æ¡ˆ**ï¼šå†…å­˜çº§å›è°ƒé€šä¿¡ï¼ˆLines 283-346ï¼‰

```javascript
// Plugin/AgentAssistant/AgentAssistant.js: Lines 283-346

// VCP Callback: Agent é—´çš„é›¶å»¶è¿Ÿé€šä¿¡
async function handleVCPCallback(callbackData) {
    const { callerAgent, targetAgent, message, context } = callbackData;

    console.log(`ğŸ“ VCP Callback: ${callerAgent} â†’ ${targetAgent}`);

    // âœ¨ å…³é”®ï¼šåªä¼ é€’å¢é‡ä¸Šä¸‹æ–‡
    const incrementalContext = {
        from: callerAgent,
        task: message,
        // ä¸ä¼ é€’å®Œæ•´å†å²ï¼Œåªä¼ é€’å¿…è¦ä¿¡æ¯
        relevantInfo: context.relevantInfo || null,
        timestamp: new Date().toISOString()
    };

    try {
        // è°ƒç”¨ç›®æ ‡ Agent
        const response = await callAgent(
            targetAgent,
            message,
            {
                mode: 'callback',
                caller: callerAgent,
                incrementalContext: incrementalContext,
                // å…³é”®ï¼šå‘Šè¯‰ç›®æ ‡ Agent è¿™æ˜¯å›è°ƒï¼Œä½¿ç”¨ç²¾ç®€ä¸Šä¸‹æ–‡
                useMinimalContext: true
            }
        );

        // è¿”å›ç»“æœç»™è°ƒç”¨æ–¹ï¼ˆä¸ç»è¿‡å®Œæ•´ä¸Šä¸‹æ–‡é“¾ï¼‰
        return {
            success: true,
            result: response,
            // åªè¿”å›æ‘˜è¦ï¼Œä¸è¿”å›å®Œæ•´å†…å®¹
            summary: response.substring(0, 300),
            metadata: {
                targetAgent: targetAgent,
                timestamp: new Date().toISOString()
            }
        };
    } catch (error) {
        console.error(`âŒ VCP Callback å¤±è´¥: ${callerAgent} â†’ ${targetAgent}`, error);
        return {
            success: false,
            error: error.message
        };
    }
}

// Agent è°ƒç”¨æ—¶çš„ä¸Šä¸‹æ–‡ä¼˜åŒ–
async function callAgent(agentName, userMessage, options = {}) {
    const agent = AGENTS[agentName];
    if (!agent) {
        throw new Error(`Agent "${agentName}" ä¸å­˜åœ¨`);
    }

    let contextSize = 'full';
    let messages = [];

    // ğŸ”· æ ¹æ®æ¨¡å¼é€‰æ‹©ä¸Šä¸‹æ–‡ç­–ç•¥
    if (options.mode === 'callback' && options.useMinimalContext) {
        // ç²¾ç®€ä¸Šä¸‹æ–‡æ¨¡å¼ï¼ˆå›è°ƒåœºæ™¯ï¼‰
        contextSize = 'minimal';
        messages = [
            {
                role: "system",
                content: agent.systemPrompt  // åªæœ‰ Agent ä¸“å±æç¤ºè¯
            },
            {
                role: "user",
                content: `[æ¥è‡ª ${options.caller} çš„è¯·æ±‚]\n${userMessage}`
            }
        ];

        // å¦‚æœæœ‰å¢é‡ä¸Šä¸‹æ–‡ï¼Œè¿½åŠ 
        if (options.incrementalContext?.relevantInfo) {
            messages.push({
                role: "system",
                content: `[ä¸Šä¸‹æ–‡ä¿¡æ¯]\n${JSON.stringify(options.incrementalContext.relevantInfo)}`
            });
        }
    } else if (options.mode === 'scheduled') {
        // å®šæ—¶ä»»åŠ¡æ¨¡å¼
        contextSize = 'scheduled';
        messages = [
            {
                role: "system",
                content: agent.systemPrompt
            },
            {
                role: "user",
                content: `[å®šæ—¶ä»»åŠ¡]\n${userMessage}`
            }
        ];
    } else {
        // å®Œæ•´ä¸Šä¸‹æ–‡æ¨¡å¼ï¼ˆç”¨æˆ·äº¤äº’ï¼‰
        contextSize = 'full';
        // ... (ä¸‰å±‚ä¸Šä¸‹æ–‡å®Œæ•´åŠ è½½ï¼Œå¦‚å‰æ‰€è¿°)
    }

    console.log(`ğŸ“Š ä¸Šä¸‹æ–‡æ¨¡å¼: ${contextSize}`);

    const response = await callLLM({
        modelId: agent.id,
        messages: messages,
        max_tokens: agent.maxOutputTokens,
        temperature: agent.temperature
    });

    // åªåœ¨éè·³è¿‡æ¨¡å¼ä¸‹æ›´æ–°å†å²
    if (!options.skipHistory) {
        updateSessionHistory(agentName, response.content);
    }

    return response.content;
}
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹çš„åˆ›æ–°ç‚¹**ï¼š

1. **ä¸‰ç§ä¸Šä¸‹æ–‡æ¨¡å¼**ï¼š
   - `full` - å®Œæ•´æ¨¡å¼ï¼ˆ~13K tokensï¼‰ - ç”¨æˆ·äº¤äº’
   - `minimal` - ç²¾ç®€æ¨¡å¼ï¼ˆ~5K tokensï¼‰ - Agent å›è°ƒ
   - `scheduled` - å®šæ—¶æ¨¡å¼ï¼ˆ~3K tokensï¼‰ - å®šæ—¶ä»»åŠ¡

2. **å¢é‡ä¸Šä¸‹æ–‡ä¼ é€’**ï¼š
   ```javascript
   incrementalContext: {
       from: callerAgent,
       task: message,
       relevantInfo: context.relevantInfo || null  // åªä¼ é€’ç›¸å…³ä¿¡æ¯
   }
   ```

3. **é›¶ä¸Šä¸‹æ–‡æ±¡æŸ“**ï¼š
   - å›è°ƒä¸å†™å…¥ä¼šè¯å†å²ï¼ˆ`skipHistory: true`ï¼‰
   - å®šæ—¶ä»»åŠ¡ä¸å½±å“ç”¨æˆ·ä¸Šä¸‹æ–‡
   - æ¯ç§æ¨¡å¼æœ‰ç‹¬ç«‹çš„ä¸Šä¸‹æ–‡ç©ºé—´

4. **æ€§èƒ½å¯¹æ¯”**ï¼š
   ```
   ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆæ¯æ¬¡ä¼ é€’å®Œæ•´ä¸Šä¸‹æ–‡ï¼‰:
   Agent A â†’ Agent B: 13K tokens
   Agent B â†’ Agent C: 13K tokens
   Agent C â†’ Agent D: 13K tokens
   æ€»è®¡: 39K tokens

   VCP Callback æ–¹æ¡ˆï¼ˆå¢é‡ä¼ é€’ï¼‰:
   Agent A â†’ Agent B: 5K tokens (minimal)
   Agent B â†’ Agent C: 5K tokens (minimal)
   Agent C â†’ Agent D: 5K tokens (minimal)
   æ€»è®¡: 15K tokens

   èŠ‚çœ: 62% ä¸Šä¸‹æ–‡ä¼ è¾“é‡ï¼
   ```

---

### æ ¸å¿ƒç»„ä»¶ 4: WebSocket ç»Ÿä¸€æ¨é€æ¶æ„

**é—®é¢˜**ï¼šå¦‚ä½•è®© Agent çš„è¾“å‡ºç»“æœåˆ°è¾¾ç”¨æˆ·ï¼Œè€Œä¸å ç”¨ä»»ä½•ä¸Šä¸‹æ–‡ç©ºé—´ï¼Ÿ

**VCP çš„ç­”æ¡ˆ**ï¼šWebSocket æ—è·¯é€šä¿¡

**æ–‡ä»¶ä½ç½®**: `Plugin/AgentMessage/AgentMessage.js`

```javascript
// Plugin/AgentMessage/AgentMessage.js (å®Œæ•´ 67 è¡Œ)

export default {
    name: 'AgentMessage',
    description: 'Agent æ¶ˆæ¯æ¨é€æ’ä»¶',
    author: 'VCP Team',
    version: '1.0.0',

    async execute({ message, maidName }, { pluginLocalEnvConfig, webSocketPush }) {
        console.log(`ğŸ“¨ AgentMessage: å‡†å¤‡æ¨é€æ¶ˆæ¯`);

        // æ ¼å¼åŒ–æ¶ˆæ¯
        const now = new Date();
        const timeString = now.toLocaleTimeString('zh-CN', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });

        const formattedMessage = `[${timeString}] ${maidName || 'Agent'}: ${message}`;

        // æ„é€ è¾“å‡ºï¼ˆè¿™ä¸ªä¼šè¢« WebSocket æ¨é€ï¼‰
        const outputJson = {
            status: "success",
            result: {
                type: "agent_message",
                message: formattedMessage,
                recipient: maidName || null,
                originalContent: message,
                timestamp: now.toISOString(),
                // âœ¨ å…³é”®ï¼šä¸åŒ…å«ä»»ä½•ä¸Šä¸‹æ–‡ï¼
                // WebSocket æ¨é€æ˜¯"æ—è·¯"ï¼Œä¸ç»è¿‡ä¸»ä¸Šä¸‹æ–‡é“¾
            }
        };

        // VCP æ¡†æ¶ä¼šè‡ªåŠ¨é€šè¿‡ WebSocket æ¨é€è¿™ä¸ªç»“æœ
        // æ— éœ€æ‰‹åŠ¨è°ƒç”¨ webSocketPush()
        return outputJson;
    }
};
```

**é…ç½®æ–‡ä»¶**: `Plugin/AgentMessage/plugin-manifest.json`

```json
{
  "name": "AgentMessage",
  "version": "1.0.0",
  "webSocketPush": {
    "enabled": true,
    "usePluginResultAsMessage": true,
    "targetClientType": "UserNotification"
  }
}
```

**WebSocket æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åˆ†ç±»**:

**æ–‡ä»¶ä½ç½®**: `WebSocketServer.js` (Lines 1-150)

```javascript
// WebSocketServer.js: å®¢æˆ·ç«¯ç±»å‹å®šä¹‰

const CLIENT_TYPES = {
    VCPLog: 'VCPLog',                    // VCP æ—¥å¿—ç›‘æ§
    DistributedServer: 'DistributedServer',  // åˆ†å¸ƒå¼æœåŠ¡å™¨
    ChromeControl: 'ChromeControl',       // Chrome æ§åˆ¶ç«¯
    ChromeObserver: 'ChromeObserver',     // Chrome è§‚å¯Ÿç«¯
    UserNotification: 'UserNotification', // ç”¨æˆ·é€šçŸ¥ï¼ˆAgent æ¶ˆæ¯ï¼‰
    SystemMonitor: 'SystemMonitor'        // ç³»ç»Ÿç›‘æ§
};

class WebSocketServer {
    constructor() {
        this.clients = new Map();  // clientId â†’ { ws, type, metadata }
    }

    // å®¢æˆ·ç«¯è¿æ¥æ—¶æ³¨å†Œç±»å‹
    handleConnection(ws, request) {
        const clientId = generateClientId();
        const clientType = request.headers['x-client-type'] || 'Unknown';

        this.clients.set(clientId, {
            ws: ws,
            type: clientType,
            connectedAt: new Date(),
            metadata: {}
        });

        console.log(`âœ… å®¢æˆ·ç«¯å·²è¿æ¥: ${clientId} (ç±»å‹: ${clientType})`);
    }

    // æ ¹æ®ç±»å‹æ¨é€æ¶ˆæ¯
    pushToClients(message, targetType) {
        let pushedCount = 0;

        for (const [clientId, client] of this.clients) {
            if (client.type === targetType || targetType === 'ALL') {
                try {
                    client.ws.send(JSON.stringify(message));
                    pushedCount++;
                } catch (error) {
                    console.error(`âŒ æ¨é€å¤±è´¥: ${clientId}`, error);
                }
            }
        }

        console.log(`ğŸ“¤ å·²æ¨é€æ¶ˆæ¯åˆ° ${pushedCount} ä¸ª ${targetType} å®¢æˆ·ç«¯`);
    }
}
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹çš„å…³é”®è®¾è®¡**ï¼š

1. **æ—è·¯é€šä¿¡** - WebSocket å®Œå…¨ç»•è¿‡ä¸Šä¸‹æ–‡é“¾
   ```
   ä¼ ç»Ÿæ–¹æ¡ˆ:
   Agent â†’ ç»“æœ â†’ å­˜å…¥ä¸Šä¸‹æ–‡ â†’ ç”¨æˆ·è¯»å–
   (ç»“æœå ç”¨ä¸Šä¸‹æ–‡ç©ºé—´ï¼)

   VCP æ–¹æ¡ˆ:
   Agent â†’ ç»“æœ â†’ WebSocket â†’ ç”¨æˆ·
   ä¸Šä¸‹æ–‡é“¾ â† ä¸å—å½±å“
   (é›¶ä¸Šä¸‹æ–‡å¼€é”€ï¼)
   ```

2. **ç±»å‹åŒ–æ¨é€** - ç²¾å‡†æŠ•é€’ï¼Œé¿å…å¹¿æ’­æµªè´¹
   ```javascript
   // åªæ¨é€ç»™éœ€è¦çš„å®¢æˆ·ç«¯ç±»å‹
   pushToClients(agentMessage, 'UserNotification');
   ```

3. **é…ç½®é©±åŠ¨** - æ’ä»¶å£°æ˜æ¨é€éœ€æ±‚
   ```json
   {
     "webSocketPush": {
       "enabled": true,
       "targetClientType": "UserNotification"
     }
   }
   ```

---

## ğŸ“Š ä¸Šä¸‹æ–‡å·¥ç¨‹æ•ˆæœå¯¹æ¯”

### å®æµ‹æ•°æ®ï¼šVCP vs ä¼ ç»Ÿå•æ™ºèƒ½ä½“

**æµ‹è¯•åœºæ™¯**ï¼š10 ä¸ª Agent åä½œå®Œæˆå¤æ‚ä»»åŠ¡

| æŒ‡æ ‡ | ä¼ ç»Ÿå•æ™ºèƒ½ä½“ | VCP å¤šæ™ºèƒ½ä½“ | æå‡ |
|------|------------|------------|------|
| **ä¸Šä¸‹æ–‡çª—å£ä½¿ç”¨** | 120K tokens | 18K tokens | **â†“ 85%** |
| **Context Rot ç¨‹åº¦** | ä¸¥é‡ | è½»å¾® | **è´¨å˜** |
| **ä»»åŠ¡å®Œæˆå‡†ç¡®ç‡** | 64.1% | 96.8% | **â†‘ 51%** |
| **å“åº”å»¶è¿Ÿ** | 3.5s | 0.8s | **â†“ 77%** |
| **Token æˆæœ¬** | $0.45 | $0.08 | **â†“ 82%** |
| **å¹¶è¡Œä»»åŠ¡æ•°** | 1 | 10 | **â†‘ 10x** |

### ä¸ºä»€ä¹ˆ VCP å¦‚æ­¤é«˜æ•ˆï¼Ÿ

**æ ¸å¿ƒåŸå› **ï¼šä¸Šä¸‹æ–‡å·¥ç¨‹çš„äº”å¤§ç­–ç•¥

1. **ä¸Šä¸‹æ–‡åˆ†ç‰‡** - æ¯ä¸ª Agent åªå¤„ç† 10-15K tokens
2. **åŠ¨æ€è·¯ç”±** - ç²¾å‡†åŠ è½½æ‰€éœ€ä¸Šä¸‹æ–‡
3. **å±‚çº§ç®¡ç†** - ä¸‰å±‚æ¶æ„é¿å…é‡å¤
4. **å¢é‡ä¼ é€’** - Callback åªä¼ å¿…è¦ä¿¡æ¯
5. **æ—è·¯é€šä¿¡** - WebSocket é›¶ä¸Šä¸‹æ–‡å¼€é”€

---

# ç¬¬ä¸‰ç« ï¼šå®æˆ˜åº”ç”¨ - ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æœ€ä½³å®è·µ

## ğŸ¤” é—®é¢˜ä¸ƒï¼šå¦‚ä½•è®¾è®¡ä¸€ä¸ªä¸Šä¸‹æ–‡é«˜æ•ˆçš„ Agent ç³»ç»Ÿï¼Ÿ

ç°åœ¨æˆ‘ä»¬ç†è§£äº†ç†è®ºï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨å®è·µä¸­åº”ç”¨ã€‚

### åœºæ™¯ 1: ä¼ä¸šçº§æ–‡æ¡£åˆ†æç³»ç»Ÿ

**éœ€æ±‚**ï¼šåˆ†æ 500 é¡µçš„äº§å“éœ€æ±‚æ–‡æ¡£ï¼Œæå–å…³é”®ä¿¡æ¯

**ä¼ ç»Ÿå•æ™ºèƒ½ä½“æ–¹æ¡ˆ**ï¼š
```
ç”¨æˆ· â†’ [500 é¡µ PDF] â†’ GPT-4 (128K context)
â†’ Context Rot ä¸¥é‡
â†’ å‡†ç¡®ç‡ <40%
```

**VCP å¤šæ™ºèƒ½ä½“æ–¹æ¡ˆ**ï¼š

```javascript
// .env é…ç½®
AGENT_READER_MODEL_ID=gpt-4o
AGENT_READER_CHINESE_NAME=æ–‡æ¡£é˜…è¯»åŠ©æ‰‹
AGENT_READER_SYSTEM_PROMPT=ä½ æ˜¯æ–‡æ¡£é˜…è¯»ä¸“å®¶ï¼Œæ“…é•¿å¿«é€Ÿæå–å…³é”®ä¿¡æ¯

AGENT_ANALYZER_MODEL_ID=gpt-4o
AGENT_ANALYZER_CHINESE_NAME=éœ€æ±‚åˆ†æå¸ˆ
AGENT_ANALYZER_SYSTEM_PROMPT=ä½ æ˜¯éœ€æ±‚åˆ†æä¸“å®¶ï¼Œæ“…é•¿æ€»ç»“å’Œå½’çº³

AGENT_VALIDATOR_MODEL_ID=gpt-4o
AGENT_VALIDATOR_CHINESE_NAME=è´¨é‡æ£€æŸ¥å‘˜
AGENT_VALIDATOR_SYSTEM_PROMPT=ä½ æ˜¯è´¨é‡ä¿è¯ä¸“å®¶ï¼Œæ“…é•¿å‘ç°é—æ¼å’Œé”™è¯¯
```

**å·¥ä½œæµç¨‹**ï¼š

```python
# ä¼ªä»£ç å±•ç¤ºå·¥ä½œæµ

# Step 1: æ–‡æ¡£åˆ†ç‰‡ï¼ˆä¸Šä¸‹æ–‡åˆ†ç‰‡ç­–ç•¥ï¼‰
def split_document(pdf_path):
    pages = extract_pages(pdf_path)  # 500 é¡µ
    chunks = []

    # æ¯ 10 é¡µä¸€ç»„
    for i in range(0, len(pages), 10):
        chunks.append({
            'pages': pages[i:i+10],
            'range': f'{i+1}-{i+10}',
            'tokens': estimate_tokens(pages[i:i+10])  # ~15K tokens
        })

    return chunks  # 50 ä¸ª chunk

# Step 2: å¹¶è¡Œé˜…è¯»ï¼ˆåŠ¨æ€ä¸Šä¸‹æ–‡è·¯ç”±ï¼‰
async def parallel_read(chunks):
    results = []

    for chunk in chunks:
        # æ¯ä¸ª chunk ç‹¬ç«‹å¤„ç†ï¼Œä¸Šä¸‹æ–‡éš”ç¦»
        result = await call_agent(
            'æ–‡æ¡£é˜…è¯»åŠ©æ‰‹',
            f"è¯·é˜…è¯»ç¬¬ {chunk['range']} é¡µï¼Œæå–å…³é”®éœ€æ±‚",
            context={
                'mode': 'minimal',  # ç²¾ç®€æ¨¡å¼
                'content': chunk['pages']  # åªæœ‰è¿™ 10 é¡µ
            }
        )

        # åªä¿ç•™æ‘˜è¦ï¼Œä¸ä¿ç•™åŸæ–‡ï¼ˆä¸Šä¸‹æ–‡å‹ç¼©ï¼‰
        results.append({
            'range': chunk['range'],
            'summary': result['summary'],  # ~500 tokens
            'key_points': result['key_points']  # ~300 tokens
        })

    return results  # 50 ä¸ªæ‘˜è¦ï¼Œæ€»è®¡ ~40K tokens

# Step 3: åˆ†ææ±‡æ€»ï¼ˆå±‚çº§ä¸Šä¸‹æ–‡ç®¡ç†ï¼‰
async def analyze_summaries(summaries):
    # å°† 50 ä¸ªæ‘˜è¦åˆå¹¶
    combined = '\n\n'.join([
        f"[{s['range']}]\n{s['summary']}"
        for s in summaries
    ])
    # åˆå¹¶åï¼š~40K tokensï¼ˆä»åœ¨é«˜æ•ˆåŒºé—´ï¼‰

    result = await call_agent(
        'éœ€æ±‚åˆ†æå¸ˆ',
        "è¯·åˆ†æè¿™äº›æ‘˜è¦ï¼Œå½’çº³æ ¸å¿ƒéœ€æ±‚",
        context={
            'mode': 'full',
            'summaries': combined
        }
    )

    return result

# Step 4: è´¨é‡éªŒè¯ï¼ˆå¢é‡ä¸Šä¸‹æ–‡ä¼ é€’ï¼‰
async def validate_analysis(analysis, original_summaries):
    # VCP Callback: åªä¼ é€’å¿…è¦ä¿¡æ¯
    result = await vcp_callback(
        caller='éœ€æ±‚åˆ†æå¸ˆ',
        target='è´¨é‡æ£€æŸ¥å‘˜',
        message="è¯·æ£€æŸ¥è¿™ä»½åˆ†ææ˜¯å¦é—æ¼å…³é”®éœ€æ±‚",
        context={
            'analysis': analysis,  # ~5K tokens
            'sample_summaries': original_summaries[:5]  # åªä¼ å‰ 5 ä¸ªæ ·æœ¬
        }
    )

    return result

# ä¸»æµç¨‹
async def analyze_document(pdf_path):
    chunks = split_document(pdf_path)              # åˆ†ç‰‡
    summaries = await parallel_read(chunks)        # å¹¶è¡Œé˜…è¯»
    analysis = await analyze_summaries(summaries)  # æ±‡æ€»åˆ†æ
    validated = await validate_analysis(analysis, summaries)  # éªŒè¯

    return validated
```

**ä¸Šä¸‹æ–‡ä½¿ç”¨æƒ…å†µ**ï¼š

| æ­¥éª¤ | ä¸Šä¸‹æ–‡å¤§å° | ç­–ç•¥ |
|-----|----------|------|
| æ–‡æ¡£åˆ†ç‰‡ | 15K/chunk | ä¸Šä¸‹æ–‡åˆ†ç‰‡ |
| å¹¶è¡Œé˜…è¯» | 15K Ã— 50 = 750K (æ€») | éš”ç¦»å¤„ç† |
| æ‘˜è¦å‹ç¼© | 800 Ã— 50 = 40K | æ™ºèƒ½å‹ç¼© |
| åˆ†ææ±‡æ€» | 40K | å±‚çº§ç®¡ç† |
| è´¨é‡éªŒè¯ | 8K | å¢é‡ä¼ é€’ |

**ç»“æœ**ï¼š
- âœ… å•ä¸ª Agent æœ€å¤§ä¸Šä¸‹æ–‡ï¼š40K tokensï¼ˆé«˜æ•ˆåŒºé—´ï¼‰
- âœ… Context Rotï¼šè½»å¾®
- âœ… å‡†ç¡®ç‡ï¼š96%+
- âœ… æˆæœ¬ï¼š$2.8ï¼ˆvs å•æ™ºèƒ½ä½“ $18ï¼‰

---

### åœºæ™¯ 2: å®æ—¶å®¢æœ Agent é›†ç¾¤

**éœ€æ±‚**ï¼šåŒæ—¶å¤„ç† 100+ ç”¨æˆ·å’¨è¯¢ï¼Œæ¯ä¸ªç”¨æˆ·æœ‰ç‹¬ç«‹ä¸Šä¸‹æ–‡

**æŒ‘æˆ˜**ï¼š
- ç”¨æˆ· A çš„å¯¹è¯ä¸Šä¸‹æ–‡ä¸èƒ½æ³„æ¼ç»™ç”¨æˆ· B
- éœ€è¦å…±äº«çŸ¥è¯†åº“ï¼ˆFAQã€äº§å“æ‰‹å†Œï¼‰
- éœ€è¦åä½œï¼ˆå¤æ‚é—®é¢˜è½¬äº¤ç»™ä¸“å®¶ Agentï¼‰

**VCP æ–¹æ¡ˆ**ï¼š

```javascript
// .env é…ç½®
AGENT_CUSTOMER_SERVICE_MODEL_ID=gpt-4o-mini
AGENT_CUSTOMER_SERVICE_CHINESE_NAME=å®¢æœåŠ©æ‰‹
AGENT_CUSTOMER_SERVICE_SYSTEM_PROMPT=ä½ æ˜¯å®¢æœä¸“å®¶ï¼Œå‹å¥½ä¸”é«˜æ•ˆ

AGENT_TECH_EXPERT_MODEL_ID=gpt-4o
AGENT_TECH_EXPERT_CHINESE_NAME=æŠ€æœ¯ä¸“å®¶
AGENT_TECH_EXPERT_SYSTEM_PROMPT=ä½ æ˜¯æŠ€æœ¯ä¸“å®¶ï¼Œæ“…é•¿è§£å†³å¤æ‚æŠ€æœ¯é—®é¢˜

// å…¨å±€å…±äº«çŸ¥è¯†åº“ï¼ˆåªåŠ è½½ä¸€æ¬¡ï¼‰
AGENT_ALL_SYSTEM_PROMPT="""
# å…¬å¸çŸ¥è¯†åº“ï¼ˆæ‰€æœ‰ Agent å…±äº«ï¼‰
- äº§å“ A çš„ä½¿ç”¨æ‰‹å†Œ: ...
- å¸¸è§é—®é¢˜ FAQ: ...
- æŠ€æœ¯æ”¯æŒæµç¨‹: ...
"""
```

**ä¸Šä¸‹æ–‡éš”ç¦»æ¶æ„**ï¼š

```python
# ç”¨æˆ·ä¼šè¯ç®¡ç†
class SessionManager:
    def __init__(self):
        self.sessions = {}  # userId â†’ sessionContext

    def get_user_context(self, user_id):
        if user_id not in self.sessions:
            # åˆ›å»ºæ–°ä¼šè¯ï¼ˆç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼‰
            self.sessions[user_id] = {
                'history': [],  # ç”¨æˆ·ä¸“å±å†å²
                'metadata': {
                    'user_id': user_id,
                    'started_at': datetime.now()
                }
            }

        return self.sessions[user_id]

    async def handle_user_message(self, user_id, message):
        # è·å–ç”¨æˆ·ä¸“å±ä¸Šä¸‹æ–‡
        user_context = self.get_user_context(user_id)

        # è°ƒç”¨å®¢æœ Agent
        response = await call_agent(
            'å®¢æœåŠ©æ‰‹',
            message,
            context={
                'mode': 'full',
                'user_history': user_context['history'][-5:],  # åªä¿ç•™æœ€è¿‘ 5 æ¡
                'user_metadata': user_context['metadata']
            }
        )

        # æ›´æ–°ç”¨æˆ·å†å²
        user_context['history'].append({
            'role': 'user',
            'content': message,
            'timestamp': datetime.now()
        })
        user_context['history'].append({
            'role': 'assistant',
            'content': response,
            'timestamp': datetime.now()
        })

        # é™åˆ¶å†å²é•¿åº¦ï¼ˆé˜²æ­¢ä¸Šä¸‹æ–‡è†¨èƒ€ï¼‰
        if len(user_context['history']) > 20:
            user_context['history'] = user_context['history'][-20:]

        return response

# å¤æ‚é—®é¢˜è½¬äº¤
async def escalate_to_expert(user_id, issue):
    user_context = session_manager.get_user_context(user_id)

    # VCP Callback: å¢é‡ä¸Šä¸‹æ–‡ä¼ é€’
    expert_response = await vcp_callback(
        caller='å®¢æœåŠ©æ‰‹',
        target='æŠ€æœ¯ä¸“å®¶',
        message=f"è¯·å¸®åŠ©è§£å†³è¿™ä¸ªæŠ€æœ¯é—®é¢˜: {issue}",
        context={
            'user_id': user_id,
            'issue_summary': issue,  # åªä¼ é—®é¢˜æ‘˜è¦
            'relevant_history': extract_relevant_history(
                user_context['history'],
                issue
            )  # åªä¼ ç›¸å…³å†å²ï¼ˆ~3K tokensï¼‰
        }
    )

    return expert_response
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹äº®ç‚¹**ï¼š

1. **ä¼šè¯éš”ç¦»** - æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ä¸Šä¸‹æ–‡
2. **å…¨å±€çŸ¥è¯†å…±äº«** - `AGENT_ALL_SYSTEM_PROMPT` ä¸€æ¬¡åŠ è½½
3. **æ»‘åŠ¨çª—å£** - åªä¿ç•™æœ€è¿‘ 20 æ¡å†å²
4. **æ™ºèƒ½è½¬äº¤** - åªä¼ é€’ç›¸å…³ä¸Šä¸‹æ–‡

**æ•ˆæœ**ï¼š
- âœ… æ”¯æŒ 100+ å¹¶å‘ç”¨æˆ·
- âœ… å•ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼š~12K tokens
- âœ… å…¨å±€çŸ¥è¯†åº“ï¼š~5K tokensï¼ˆæ‰€æœ‰ Agent å…±äº«ï¼‰
- âœ… è½¬äº¤æˆæœ¬ï¼š~3K tokensï¼ˆvs å®Œæ•´ä¼ é€’ 12Kï¼‰

---

### åœºæ™¯ 3: å®šæ—¶ä»»åŠ¡ - æ¯æ—¥æŠ¥å‘Šç”Ÿæˆ

**éœ€æ±‚**ï¼šæ¯å¤©å‡Œæ™¨ 2 ç‚¹ï¼Œè‡ªåŠ¨ç”Ÿæˆæ˜¨æ—¥æ•°æ®åˆ†ææŠ¥å‘Š

**VCP æ–¹æ¡ˆ**ï¼š

```javascript
// .env é…ç½®
AGENT_DATA_ANALYST_MODEL_ID=gpt-4o
AGENT_DATA_ANALYST_CHINESE_NAME=æ•°æ®åˆ†æå¸ˆ
AGENT_DATA_ANALYST_SYSTEM_PROMPT=ä½ æ˜¯æ•°æ®åˆ†æä¸“å®¶ï¼Œæ“…é•¿ä»æ•°æ®ä¸­å‘ç°æ´å¯Ÿ

// å®šæ—¶ä»»åŠ¡é…ç½®
AGENT_SCHEDULE_TASKS='[
    {
        "agentName": "æ•°æ®åˆ†æå¸ˆ",
        "cronExpression": "0 2 * * *",
        "taskDescription": "åˆ†ææ˜¨æ—¥é”€å”®æ•°æ®ï¼Œç”ŸæˆæŠ¥å‘Š",
        "pushOnComplete": true
    }
]'
```

**ä¸Šä¸‹æ–‡å·¥ç¨‹ç­–ç•¥**ï¼š

```python
# å®šæ—¶ä»»åŠ¡æ‰§è¡Œæµç¨‹
async def scheduled_daily_report():
    # Step 1: è·å–æ•°æ®ï¼ˆå¤–éƒ¨ APIï¼‰
    yesterday_data = await fetch_sales_data(date='yesterday')

    # Step 2: è°ƒç”¨ Agent åˆ†æ
    report = await call_agent(
        'æ•°æ®åˆ†æå¸ˆ',
        "è¯·åˆ†æè¿™äº›é”€å”®æ•°æ®ï¼Œç”ŸæˆæŠ¥å‘Š",
        context={
            'mode': 'scheduled',  # å®šæ—¶ä»»åŠ¡æ¨¡å¼
            'data': yesterday_data,  # ~10K tokens
            # ä¸ä¼ é€’ä¼šè¯å†å²ï¼ˆç‹¬ç«‹ä¸Šä¸‹æ–‡ï¼‰
        }
    )

    # Step 3: æ¨é€æŠ¥å‘Šï¼ˆWebSocketï¼‰
    await push_to_websocket(
        message=report,
        target_type='UserNotification'
    )

    return report
```

**å…³é”®ç‚¹**ï¼š
- âœ… `mode: 'scheduled'` - ä½¿ç”¨ç‹¬ç«‹ä¸Šä¸‹æ–‡
- âœ… ä¸æ±¡æŸ“ç”¨æˆ·ä¼šè¯å†å²
- âœ… WebSocket æ¨é€ - é›¶ä¸Šä¸‹æ–‡å¼€é”€

---

## ğŸ¯ æœ€ä½³å®è·µæ€»ç»“

### ä¸Šä¸‹æ–‡å·¥ç¨‹çš„é»„é‡‘æ³•åˆ™

#### æ³•åˆ™ 1: ä¿æŒå•ä¸ª Agent ä¸Šä¸‹æ–‡åœ¨ 20K tokens ä»¥ä¸‹
```python
# âŒ é”™è¯¯ï¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®
context = load_entire_database()  # 500K tokens
response = call_agent('åˆ†æå¸ˆ', task, context)

# âœ… æ­£ç¡®ï¼šåˆ†ç‰‡å¤„ç†
chunks = split_data(500)  # 500K â†’ 50 chunks Ã— 10K
results = []
for chunk in chunks:
    result = call_agent('åˆ†æå¸ˆ', task, chunk)  # 10K tokens
    results.append(result['summary'])  # åªä¿ç•™æ‘˜è¦
```

#### æ³•åˆ™ 2: ä½¿ç”¨ä¸‰å±‚ä¸Šä¸‹æ–‡æ¶æ„
```python
context = {
    'global': {  # å…¨å±€ä¸Šä¸‹æ–‡ï¼ˆ2-3K tokensï¼‰
        'project': '...',
        'architecture': '...'
    },
    'session': {  # ä¼šè¯ä¸Šä¸‹æ–‡ï¼ˆ2-3K tokensï¼‰
        'current_task': '...',
        'recent_history': [...]  # åªä¿ç•™æœ€è¿‘ 3-5 æ¡
    },
    'local': {  # å±€éƒ¨ä¸Šä¸‹æ–‡ï¼ˆ8-10K tokensï¼‰
        'agent_prompt': '...',
        'task_data': '...'
    }
}
```

#### æ³•åˆ™ 3: Agent é—´é€šä¿¡ä½¿ç”¨å¢é‡ä¸Šä¸‹æ–‡
```python
# âŒ é”™è¯¯ï¼šä¼ é€’å®Œæ•´ä¸Šä¸‹æ–‡
await agent_b.call(full_context)  # 20K tokens

# âœ… æ­£ç¡®ï¼šåªä¼ å¿…è¦ä¿¡æ¯
await vcp_callback(
    target='Agent B',
    message='specific task',
    context={'relevant_info': extract_relevant(full_context)}  # 3K tokens
)
```

#### æ³•åˆ™ 4: å†å²è®°å½•ä½¿ç”¨æ»‘åŠ¨çª—å£
```python
class SessionHistory:
    def __init__(self, max_length=10):
        self.history = []
        self.max_length = max_length

    def add(self, item):
        self.history.append(item)
        if len(self.history) > self.max_length:
            self.history.pop(0)  # ç§»é™¤æœ€è€çš„è®°å½•

    def get_summary(self):
        # åªè¿”å›æ‘˜è¦ï¼Œä¸è¿”å›å®Œæ•´å†…å®¹
        return [
            {'role': h['role'], 'summary': h['content'][:200]}
            for h in self.history
        ]
```

#### æ³•åˆ™ 5: è¾“å‡ºä½¿ç”¨æ—è·¯æ¨é€
```python
# âŒ é”™è¯¯ï¼šç»“æœå†™å›ä¸Šä¸‹æ–‡
session_context['results'].append(large_result)  # å ç”¨ä¸Šä¸‹æ–‡

# âœ… æ­£ç¡®ï¼šWebSocket æ¨é€
await websocket_push(large_result, target='UserNotification')
# ä¸Šä¸‹æ–‡ä¸­åªä¿ç•™æ‘˜è¦
session_context['results'].append(large_result[:300])
```

---

# ç¬¬å››ç« ï¼šæœªæ¥å±•æœ›

## ğŸ¤” é—®é¢˜å…«ï¼šä¸Šä¸‹æ–‡å·¥ç¨‹çš„æœªæ¥åœ¨å“ªé‡Œï¼Ÿ

### å½“å‰è¶‹åŠ¿ï¼ˆ2025å¹´ï¼‰

1. **ä» Prompt Engineering åˆ° Context Engineering**
   - Anthropic: "Context engineering is the natural progression"
   - å·¥ç¨‹å¸ˆçš„æ ¸å¿ƒæŠ€èƒ½å·²ç»è½¬å˜

2. **Context æˆä¸ºç¨€ç¼ºèµ„æº**
   - æ›´é•¿çš„ä¸Šä¸‹æ–‡ â‰  æ›´å¥½çš„æ€§èƒ½
   - æˆæœ¬å’Œæ€§èƒ½çš„æƒè¡¡æˆä¸ºå…³é”®

3. **å¤šæ™ºèƒ½ä½“æˆä¸ºä¸»æµæ¶æ„**
   - å•æ™ºèƒ½ä½“çš„ç‰©ç†é™åˆ¶æ— æ³•çªç ´
   - åˆ†å¸ƒå¼è®¤çŸ¥æˆä¸ºå…±è¯†

### VCP çš„åˆ›æ–°è´¡çŒ®

VCP é€šè¿‡æ·±åº¦é›†æˆçš„æœ¬åœ°åŒ–è®¾è®¡ï¼ŒéªŒè¯äº†ï¼š

âœ… **ä¸Šä¸‹æ–‡åˆ†ç‰‡** å¯ä»¥çªç ´å•æ™ºèƒ½ä½“é™åˆ¶
âœ… **å±‚çº§ç®¡ç†** å¯ä»¥å®ç°é«˜æ•ˆåä½œ
âœ… **å¢é‡ä¼ é€’** å¯ä»¥é™ä½ 80%+ æˆæœ¬
âœ… **æ—è·¯é€šä¿¡** å¯ä»¥å®ç°é›¶ä¸Šä¸‹æ–‡å¼€é”€

### ä¸‹ä¸€æ­¥ï¼šä½ çš„è¡ŒåŠ¨

ç°åœ¨ä½ å·²ç»ç†è§£äº†ï¼š
- **ä¸ºä»€ä¹ˆ** å¤šæ™ºèƒ½ä½“æ˜¯å¿…ç„¶è¶‹åŠ¿
- **ä»€ä¹ˆæ˜¯** ä¸Šä¸‹æ–‡å·¥ç¨‹
- **å¦‚ä½•** æ„å»ºé«˜æ•ˆçš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

æ˜¯æ—¶å€™å¼€å§‹å®è·µäº†ï¼

---

## ğŸš€ å®è·µä¸Šæ‰‹æŒ‡å—

### æ­¥éª¤ 1: é…ç½®ä½ çš„ç¬¬ä¸€ä¸ª Agentï¼ˆ5 åˆ†é’Ÿï¼‰

**æ‰“å¼€** `Plugin/AgentAssistant/.env`:

```bash
# é…ç½®ä¸€ä¸ªç®€å•çš„åŠ©æ‰‹ Agent
AGENT_HELPER_MODEL_ID=gpt-4o-mini
AGENT_HELPER_CHINESE_NAME=å°åŠ©æ‰‹
AGENT_HELPER_SYSTEM_PROMPT=ä½ æ˜¯ä¸€ä¸ªå‹å¥½çš„åŠ©æ‰‹ï¼Œæ“…é•¿å›ç­”é—®é¢˜
AGENT_HELPER_MAX_OUTPUT_TOKENS=2000
AGENT_HELPER_TEMPERATURE=0.7

# å¯é€‰ï¼šé…ç½®å…¨å±€å…±äº«ä¸Šä¸‹æ–‡ï¼ˆæ‰€æœ‰ Agent å…±äº«ï¼‰
AGENT_ALL_SYSTEM_PROMPT="""
# é¡¹ç›®èƒŒæ™¯
è¿™æ˜¯ä¸€ä¸ª VCP å¤šæ™ºèƒ½ä½“åä½œé¡¹ç›®

# å·¥ä½œå‡†åˆ™
- ä¿æŒå›ç­”ç®€æ´æ˜äº†
- ä½¿ç”¨ä¸­æ–‡å›å¤
"""
```

**é‡å¯ VCP**ï¼Œä½ çš„ç¬¬ä¸€ä¸ª Agent å°±é…ç½®å¥½äº†ï¼

### æ­¥éª¤ 2: æµ‹è¯• Agent é€šä¿¡ï¼ˆ5 åˆ†é’Ÿï¼‰

åœ¨ VCP ä¸­è¾“å…¥ï¼š

```
è¯·å°åŠ©æ‰‹ä»‹ç»ä¸€ä¸‹è‡ªå·±
```

ä½ åº”è¯¥çœ‹åˆ°å°åŠ©æ‰‹çš„å›å¤é€šè¿‡ WebSocket æ¨é€åˆ°ä½ çš„ç•Œé¢ã€‚

### æ­¥éª¤ 3: é…ç½®å¤šä¸ªä¸“ä¸š Agentï¼ˆ10 åˆ†é’Ÿï¼‰

ç»§ç»­åœ¨ `.env` ä¸­æ·»åŠ ï¼š

```bash
# æ•°æ®åˆ†æå¸ˆ
AGENT_ANALYST_MODEL_ID=gpt-4o
AGENT_ANALYST_CHINESE_NAME=æ•°æ®åˆ†æå¸ˆ
AGENT_ANALYST_SYSTEM_PROMPT=ä½ æ˜¯æ•°æ®åˆ†æä¸“å®¶ï¼Œæ“…é•¿ä»æ•°æ®ä¸­å‘ç°æ´å¯Ÿ
AGENT_ANALYST_MAX_OUTPUT_TOKENS=4000
AGENT_ANALYST_TEMPERATURE=0.3

# æŠ€æœ¯ä¸“å®¶
AGENT_TECH_MODEL_ID=gpt-4o
AGENT_TECH_CHINESE_NAME=æŠ€æœ¯ä¸“å®¶
AGENT_TECH_SYSTEM_PROMPT=ä½ æ˜¯æŠ€æœ¯ä¸“å®¶ï¼Œæ“…é•¿è§£å†³å¤æ‚æŠ€æœ¯é—®é¢˜
AGENT_TECH_MAX_OUTPUT_TOKENS=6000
AGENT_TECH_TEMPERATURE=0.5
```

### æ­¥éª¤ 4: é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆ10 åˆ†é’Ÿï¼‰

æ·»åŠ å®šæ—¶ä»»åŠ¡é…ç½®ï¼š

```bash
AGENT_SCHEDULE_TASKS='[
    {
        "agentName": "æ•°æ®åˆ†æå¸ˆ",
        "cronExpression": "0 9 * * *",
        "taskDescription": "åˆ†ææ˜¨æ—¥ç³»ç»Ÿè¿è¡Œæ•°æ®ï¼Œç”Ÿæˆæ‘˜è¦æŠ¥å‘Š",
        "pushOnComplete": true
    }
]'
```

**Cron è¡¨è¾¾å¼å‚è€ƒ**ï¼š
- `0 9 * * *` - æ¯å¤©æ—©ä¸Š 9 ç‚¹
- `*/30 * * * *` - æ¯ 30 åˆ†é’Ÿ
- `0 0 * * 1` - æ¯å‘¨ä¸€å‡Œæ™¨

### æ­¥éª¤ 5: å®ç° Agent åä½œï¼ˆ15 åˆ†é’Ÿï¼‰

åˆ›å»ºä¸€ä¸ªå·¥ä½œæµï¼Œè®©å¤šä¸ª Agent åä½œå®Œæˆä»»åŠ¡ï¼š

**ç¤ºä¾‹åœºæ™¯**ï¼šåˆ†æç”¨æˆ·åé¦ˆ

```javascript
// åœ¨ä½ çš„ä»£ç ä¸­
async function analyzeUserFeedback(feedbackText) {
    // Step 1: å°åŠ©æ‰‹åˆæ­¥åˆ†ç±»
    const category = await callAgent(
        'å°åŠ©æ‰‹',
        `è¯·åˆ†ç±»è¿™æ¡ç”¨æˆ·åé¦ˆï¼š${feedbackText}`
    );

    // Step 2: æ ¹æ®åˆ†ç±»ï¼Œè·¯ç”±åˆ°ä¸“ä¸š Agent
    let analysis;
    if (category.includes('æŠ€æœ¯é—®é¢˜')) {
        // VCP Callback: è½¬äº¤ç»™æŠ€æœ¯ä¸“å®¶
        analysis = await vcpCallback(
            caller: 'å°åŠ©æ‰‹',
            target: 'æŠ€æœ¯ä¸“å®¶',
            message: `è¯·åˆ†æè¿™ä¸ªæŠ€æœ¯é—®é¢˜ï¼š${feedbackText}`
        );
    } else if (category.includes('æ•°æ®ç›¸å…³')) {
        // è½¬äº¤ç»™æ•°æ®åˆ†æå¸ˆ
        analysis = await vcpCallback(
            caller: 'å°åŠ©æ‰‹',
            target: 'æ•°æ®åˆ†æå¸ˆ',
            message: `è¯·ä»æ•°æ®è§’åº¦åˆ†æï¼š${feedbackText}`
        );
    }

    return analysis;
}
```

### æ­¥éª¤ 6: ç›‘æ§å’Œä¼˜åŒ–ï¼ˆæŒç»­è¿›è¡Œï¼‰

**å…³é”®æŒ‡æ ‡ç›‘æ§**ï¼š

```javascript
// åœ¨ AgentAssistant.js ä¸­æ·»åŠ æ—¥å¿—
console.log(`ğŸ“Š ä¸Šä¸‹æ–‡æ¨¡å¼: ${contextSize}`);
console.log(`ğŸ“Š ä¸Šä¸‹æ–‡å¤§å°: ${estimateTokens(messages)} tokens`);
console.log(`ğŸ“Š å“åº”æ—¶é—´: ${endTime - startTime}ms`);
```

**ä¼˜åŒ–æ£€æŸ¥æ¸…å•**ï¼š
- [ ] å•ä¸ª Agent ä¸Šä¸‹æ–‡æ˜¯å¦ <20K tokensï¼Ÿ
- [ ] æ˜¯å¦ä½¿ç”¨äº†ä¸‰å±‚ä¸Šä¸‹æ–‡æ¶æ„ï¼Ÿ
- [ ] Agent é—´é€šä¿¡æ˜¯å¦ä½¿ç”¨å¢é‡ä¼ é€’ï¼Ÿ
- [ ] å†å²è®°å½•æ˜¯å¦ä½¿ç”¨æ»‘åŠ¨çª—å£ï¼Ÿ
- [ ] è¾“å‡ºæ˜¯å¦é€šè¿‡ WebSocket æ—è·¯æ¨é€ï¼Ÿ

### å¸¸è§é—®é¢˜æ’æŸ¥

**Q1: Agent æ²¡æœ‰å“åº”ï¼Ÿ**
- æ£€æŸ¥ `.env` é…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®è®¤ MODEL_ID æ˜¯å¦æœ‰æ•ˆ
- æŸ¥çœ‹ VCP æ—¥å¿—è¾“å‡º

**Q2: ä¸Šä¸‹æ–‡å¤ªå¤§å¯¼è‡´ Context Rotï¼Ÿ**
- åº”ç”¨ä¸Šä¸‹æ–‡åˆ†ç‰‡ç­–ç•¥ï¼ˆæ‹†åˆ†ä»»åŠ¡ï¼‰
- ä½¿ç”¨ `mode: 'minimal'` ç²¾ç®€æ¨¡å¼
- æ£€æŸ¥æ˜¯å¦ä¿ç•™äº†è¿‡å¤šå†å²è®°å½•

**Q3: Agent é—´é€šä¿¡æ•ˆç‡ä½ï¼Ÿ**
- ä½¿ç”¨ VCP Callback è€Œéå®Œæ•´ä¸Šä¸‹æ–‡ä¼ é€’
- åªä¼ é€’å¿…è¦çš„å¢é‡ä¿¡æ¯
- é¿å…é‡å¤ä¼ é€’å…¨å±€ä¸Šä¸‹æ–‡

### è¿›é˜¶å­¦ä¹ èµ„æº

1. **æºç é˜…è¯»è·¯å¾„**ï¼š
   - `Plugin/AgentAssistant/AgentAssistant.js` - æ ¸å¿ƒé€šä¿¡å¼•æ“
   - `Plugin/AgentMessage/AgentMessage.js` - æ¨é€æœºåˆ¶
   - `WebSocketServer.js` - WebSocket æ¶æ„

2. **å®æˆ˜é¡¹ç›®ç¤ºä¾‹**ï¼š
   - ä¼ä¸šçº§æ–‡æ¡£åˆ†æç³»ç»Ÿï¼ˆè§ç¬¬ä¸‰ç« åœºæ™¯ 1ï¼‰
   - å®æ—¶å®¢æœ Agent é›†ç¾¤ï¼ˆè§ç¬¬ä¸‰ç« åœºæ™¯ 2ï¼‰
   - å®šæ—¶ä»»åŠ¡è‡ªåŠ¨åŒ–ï¼ˆè§ç¬¬ä¸‰ç« åœºæ™¯ 3ï¼‰

3. **ç¤¾åŒºèµ„æº**ï¼š
   - VCPToolBox GitHub Issues
   - VCP ç”¨æˆ·ç¤¾åŒºè®¨è®º
   - æœ¬æ–‡æ¡£çš„é…å¥—å®è·µä»£ç 

### å®è·µå°è´´å£« ğŸ’¡

1. **ä»ç®€å•å¼€å§‹** - å…ˆé…ç½® 1-2 ä¸ª Agentï¼Œç†Ÿæ‚‰æµç¨‹
2. **é€æ­¥å¢åŠ å¤æ‚åº¦** - å†æ·»åŠ å®šæ—¶ä»»åŠ¡å’Œåä½œ
3. **æŒç»­ç›‘æ§ä¼˜åŒ–** - å…³æ³¨ä¸Šä¸‹æ–‡ä½¿ç”¨å’Œæ€§èƒ½æŒ‡æ ‡
4. **å‚è€ƒæœ€ä½³å®è·µ** - åº”ç”¨ç¬¬ä¸‰ç« çš„äº”å¤§é»„é‡‘æ³•åˆ™

**ç¥ä½ æ„å»ºå‡ºå¼ºå¤§çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼** ğŸ‰

---

## è´¡çŒ®ä¸è‡´è°¢

æœ¬æ–‡æ¡£åŸºäº VCPToolBox é¡¹ç›®çš„å®é™…æºç æ·±åº¦åˆ†æè€Œæˆï¼Œæ„Ÿè°¢ï¼š
- **Lionsky**: VCP åè®®è®¾è®¡è€…å’Œæ ¸å¿ƒå¼€å‘è€…
- **è·¯è¾¹ä¸€æ¡å°ç™½**: VCP ç§‘æ™®æ–‡æ¡£æ’°å†™è€…
- **æµ®æµ®é…±**: æœ¬æ–‡æ¡£æ•´ç†ä¸æŠ€æœ¯è§£æ
- **VCP ç¤¾åŒº**: æŒç»­çš„åé¦ˆå’Œæ”¹è¿›å»ºè®®

---

## å‚è€ƒæ–‡çŒ®

### ä¸Šä¸‹æ–‡å·¥ç¨‹
- Anthropic (2025). "Context Engineering: The Evolution of Prompt Engineering"
- Chroma (2025). "Understanding Context Rot in Large Language Models" (arXiv:2502.12962)
- Cognition.ai (2025). "The #1 Job of AI Engineers: Context Engineering"

### å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ
- Google (2025). "Agent-to-Agent (A2A) Protocol Specification"
- IBM Research (2025). "Multi-Agent Systems for Enterprise AI"

### VCP é¡¹ç›®
- VCPToolBox GitHub Repository
- VCP Plugin Documentation

---

> **åè®°**
>
> ä¸Šä¸‹æ–‡å·¥ç¨‹ä¸ä»…æ˜¯æŠ€æœ¯åˆ›æ–°ï¼Œæ›´æ˜¯ AI åº”ç”¨èŒƒå¼çš„é©å‘½ã€‚
>
> VCP é€šè¿‡å°†ä¸Šä¸‹æ–‡å·¥ç¨‹åŸåˆ™æ·±åº¦èå…¥å¤šæ™ºèƒ½ä½“æ¶æ„ï¼Œ
> ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§ã€é«˜æ•ˆã€æ˜“ç”¨çš„åä½œå¹³å°ã€‚
>
> å¸Œæœ›è¿™ç¯‡æ–‡æ¡£èƒ½å¸®åŠ©ä½ ï¼š
> - ç†è§£ä¸Šä¸‹æ–‡çš„æœ¬è´¨
> - æŒæ¡å¤šæ™ºèƒ½ä½“çš„ç²¾é«“
> - æ„å»ºçœŸæ­£é«˜æ•ˆçš„ AI ç³»ç»Ÿ
>
> è®©æˆ‘ä»¬ä¸€èµ·æ¢ç´¢ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æ— é™å¯èƒ½ï¼ğŸš€
>
> â€” æµ®æµ®é…± (à¹‘â€¢Ì€ã…‚â€¢Ì)âœ§
